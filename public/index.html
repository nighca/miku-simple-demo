<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta http-equiv="X-UA-Compatible" content="IE=edge">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Miku</title>
  <link rel="stylesheet" href="/style.css">
</head>
<body>
  <div class="container">
    <main class="main">
      <h1 class="title">
        Miku Traffic Test
      </h1>

      <pre class="sample-code"><code>&lt;script src="/miku-0.10.2-fix-traffic.2.js"&gt;&lt;/script&gt;

&lt;script&gt;
  miku.initProxy('/miku-sw-0.10.2-fix-traffic.2.js', {
    app: { appID: '&lt;APP_ID&gt;', appSalt: '&lt;APP_SALT&gt;' },
    domains: ['ro7756kg8.hb-bkt.clouddn.com']
  })
&lt;/script&gt;</code></pre>

      <ul class="grid">
        <li class="card">
          <h2>Image</h2>
          <img alt="Fabric" src="https://ro7756kg8.hb-bkt.clouddn.com/fabric.jpg" />
          <p className="url">
            <a target="_blank" rel="noreferrer" href="https://ro7756kg8.hb-bkt.clouddn.com/fabric.jpeg">
              <code>fabric.jpeg</code>
            </a>
          </p>
        </li>
        <li class="card">
          <h2>Long Video</h2>
          <video id="long-video" controls></video>
          <p className="url">
            <a target="_blank" rel="noreferrer" href="https://ro7756kg8.hb-bkt.clouddn.com/the-internets-own-boy.ogv">
              <code>the-internets-own-boy.ogv</code>
            </a>
          </p>
        </li>
      </ul>
    </main>
  </div>

  <script src="/miku-0.10.2-fix-traffic.2.js"></script>

  <script>
    miku.initProxy('/miku-sw-0.10.2-fix-traffic.2.js', {
      app: { appID: 'sd1bl5i6pjh2g7nr', appSalt: 'zan42dtczawcs10fn2pz1kr34vc6b640' },
      domains: ['ro7756kg8.hb-bkt.clouddn.com'],
      client: {
        mediaOptimization: {
          // 为方便查看代理效果，这里配置一个较小的首开优化阈值
          threshold: 1024 * 10
        }
      }
    }).then(() => setTimeout(() => { // 推迟播放器初始化的时间，避免播放器生命周期内部分请求未走代理、部分走代理导致的异常（TODO: 搞清楚异常的原因）
      document.getElementById('long-video').src = 'https://ro7756kg8.hb-bkt.clouddn.com/the-internets-own-boy.ogv'
    }, 200))
  </script>

</body>
</html>
