var Ba=Object.defineProperty,Ea=Object.defineProperties;var Aa=Object.getOwnPropertyDescriptors;var v0=Object.getOwnPropertySymbols;var sn=Object.prototype.hasOwnProperty,an=Object.prototype.propertyIsEnumerable;var Et=(re,ne,Q)=>ne in re?Ba(re,ne,{enumerable:!0,configurable:!0,writable:!0,value:Q}):re[ne]=Q,Z=(re,ne)=>{for(var Q in ne||(ne={}))sn.call(ne,Q)&&Et(re,Q,ne[Q]);if(v0)for(var Q of v0(ne))an.call(ne,Q)&&Et(re,Q,ne[Q]);return re},be=(re,ne)=>Ea(re,Aa(ne));var n0=(re,ne)=>{var Q={};for(var ue in re)sn.call(re,ue)&&ne.indexOf(ue)<0&&(Q[ue]=re[ue]);if(re!=null&&v0)for(var ue of v0(re))ne.indexOf(ue)<0&&an.call(re,ue)&&(Q[ue]=re[ue]);return Q};var L=(re,ne,Q)=>(Et(re,typeof ne!="symbol"?ne+"":ne,Q),Q);var z=(re,ne,Q)=>new Promise((ue,s0)=>{var p0=ge=>{try{Ge(Q.next(ge))}catch(qe){s0(qe)}},w0=ge=>{try{Ge(Q.throw(ge))}catch(qe){s0(qe)}},Ge=ge=>ge.done?ue(ge.value):Promise.resolve(ge.value).then(p0,w0);Ge((Q=Q.apply(re,ne)).next())});(function(){"use strict";function re(s){const e=[],t=s.length;for(let r=0;r<t;r++){let n=s.charCodeAt(r);if(n>=55296&&n<=56319&&t>r+1){const a=s.charCodeAt(r+1);a>=56320&&a<=57343&&(n=(n-55296)*1024+a-56320+65536,r+=1)}if(n<128){e.push(n);continue}if(n<2048){e.push(n>>6|192),e.push(n&63|128);continue}if(n<55296||n>=57344&&n<65536){e.push(n>>12|224),e.push(n>>6&63|128),e.push(n&63|128);continue}if(n>=65536&&n<=1114111){e.push(n>>18|240),e.push(n>>12&63|128),e.push(n>>6&63|128),e.push(n&63|128);continue}e.push(239,191,189)}return new Uint8Array(e).buffer}function ne(s){return s^=s>>>16,s=Math.imul(s,2246822507),s^=s>>>13,s=Math.imul(s,3266489909),s^=s>>>16,s>>>0}const Q=new Uint32Array([3432918353,461845907]);function ue(s,e){return s<<e|s>>>32-e}function s0(s,e){const t=s.byteLength/4|0,r=new Uint32Array(s,0,t);for(let n=0;n<t;n++)r[n]=Math.imul(r[n],Q[0]),r[n]=ue(r[n],15),r[n]=Math.imul(r[n],Q[1]),e[0]=e[0]^r[n],e[0]=ue(e[0],13),e[0]=Math.imul(e[0],5)+3864292196}function p0(s,e){const t=s.byteLength/4|0,r=s.byteLength%4;let n=0;const a=new Uint8Array(s,t*4,r);switch(r){case 3:n=n^a[2]<<16;case 2:n=n^a[1]<<8;case 1:n=n^a[0]<<0,n=Math.imul(n,Q[0]),n=ue(n,15),n=Math.imul(n,Q[1]),e[0]=e[0]^n}}function w0(s,e){e[0]=e[0]^s.byteLength,e[0]=ne(e[0])}function Ge(s,e){if(e=e?e|0:0,typeof s=="string"&&(s=re(s)),!(s instanceof ArrayBuffer))throw new TypeError("Expected key to be ArrayBuffer or string");const t=new Uint32Array([e]);return s0(s,t),p0(s,t),w0(s,t),t.buffer}class ge{constructor(e=on){L(this,"circle",new Map);L(this,"members",new Set);L(this,"membersReplicas",new Map);L(this,"sortedHashes",[]);this.hasher=e}clone(){const e=new ge;return e.circle=new Map(this.circle),e.members=new Set(this.members),e.membersReplicas=new Map(this.membersReplicas),e.sortedHashes=[...this.sortedHashes],e}updateSortedHashes(){this.sortedHashes=[...this.circle.keys()].sort((e,t)=>e-t)}_add({key:e,replicas:t}){for(let r=0;r<t;r++){const n=this.hasher(qe(e,r));this.circle.set(n,e)}this.members.add(e),this.membersReplicas.set(e,t)}_remove({key:e,replicas:t}){for(let r=0;r<t;r++){const n=this.hasher(qe(e,r));this.circle.delete(n)}this.members.delete(e),this.membersReplicas.delete(e)}get(e){var n;if(this.circle.size===0)return null;const t=this.hasher(e),r=(n=this.sortedHashes.find(a=>a>t))!=null?n:this.sortedHashes[0];return this.circle.get(r)}add(e,t){return this.members.has(e)?!1:(this._add({key:e,replicas:t}),this.updateSortedHashes(),!0)}remove(e){if(!this.members.has(e))return!1;const t=this.membersReplicas.get(e);return this._remove({key:e,replicas:t}),this.updateSortedHashes(),!0}set(e){this.circle.clear(),this.members.clear(),this.membersReplicas.clear(),e.forEach(t=>{this._add(t)}),this.updateSortedHashes()}}function qe(s,e){return e+s}const on=cn;function cn(s){const e=Ge(s);return new Uint32Array(e)[0]}let At=!1;function ve(s){return(...e)=>{At&&console.debug(`[${s}] [${(Date.now()/1e3).toFixed(3)}]`,...e)}}function ln(){At=!0}const g0="https://api.qiniudns.com/v1/resolve",Dt="https://log.qiniuapi.com",b0="https://pili-zeus.qiniuapi.com/v1/scheduling";function je(s){const e=s.get("Content-Length");return e?parseInt(e,10):null}function un(s){const e=s.get("Content-Range");return e==null?null:fn(e)}function fn(s){const e=s.trim().toLowerCase(),[t,r]=e.split(/\s+/);if(t!=="bytes")throw new Error(`Unit must be bytes: ${s}`);const[n,a]=r.split("/"),d=a==="*"?null:y0(a),[c,x]=(n.includes("-")?n.split("-"):[null,null]).map(i=>y0(i));return{totalSize:d,start:c,end:x}}function m0(s){const e=s.start!=null&&s.end!=null?`${s.start}-${s.end}`:"*",t=s.totalSize==null?"*":s.totalSize+"";return`bytes ${e}/${t}`}function y0(s){return s?Number(s):null}function a0(s){const e=s.get("Range");return e==null?null:Tt(e)}function Ht(s){return s.start===0&&s.end==null}function Tt(s){const e=s.trim().toLowerCase();if(!e.startsWith("bytes="))throw new Error(`Unit must be bytes: ${s}`);if(e.includes(","))throw new Error(`Multiple range: ${s}`);const[,t,r]=/(\d*)-(\d*)/.exec(e)||[];if(!t&&!r)throw new Error(`Invalid range values: ${s}`);if(!t)throw new Error("Suffix range not supported");const[n,a]=[t,r].map(d=>y0(d));return{start:n,end:a}}function _0(s){var e,t;return`bytes=${(e=s.start)!=null?e:0}-${(t=s.end)!=null?t:""}`}function Pt(s){return Object.keys(s).map(e=>[e,s[e]]).filter(([e,t])=>t!==void 0).map(([e,t])=>t===null?e:[e,t].map(encodeURIComponent).join("=")).join("&")}function hn(s,e,t,r){if(s==="HEAD")return[!1];if(e>=100&&e<200)return[!1];if(e===204||e===304)return[!1];if(s==="CONNECT"&&e>=200&&e<300)return[!1];const n=t.get("Transfer-Encoding");if(n!=null&&n.length>0)return[!0,null];const a=r.get("Content-Length");if(a!=null){const d=parseInt(a,10);if(!Number.isNaN(d))return d===0?[!1]:[!0,d]}return[!0,null]}const dn=/[^\u0000-\u00ff]/;function zt(s){return dn.test(s)?"REPLACED_BY_Miku_SEE_Miku_utils_http_encodeHeaderValue":s}function C0(s){if(s instanceof Headers){const e={};s.forEach((t,r)=>{e[r]=zt(t)}),s=e}if(Array.isArray(s)){const e={};s.forEach(([t,r])=>{e[r]=zt(t)}),s=e}return new Headers(s)}function Lt(s){var t;let e=null;if(s.status===200){const r=s.headers.get("Content-Length");e=r!=null?parseInt(r,10):null}if(s.status===206){const r=un(s.headers);e=(t=r==null?void 0:r.totalSize)!=null?t:null}return e}var M=typeof globalThis!="undefined"?globalThis:typeof window!="undefined"?window:typeof global!="undefined"?global:typeof self!="undefined"?self:{};function xn(s){var e=s.default;if(typeof e=="function"){var t=function(){return e.apply(this,arguments)};t.prototype=e.prototype}else t={};return Object.defineProperty(t,"__esModule",{value:!0}),Object.keys(s).forEach(function(r){var n=Object.getOwnPropertyDescriptor(s,r);Object.defineProperty(t,r,n.get?n:{enumerable:!0,get:function(){return s[r]}})}),t}var It={exports:{}};function vn(s){throw new Error('Could not dynamically require "'+s+'". Please configure the dynamicRequireTargets or/and ignoreDynamicRequires option of @rollup/plugin-commonjs appropriately for this require call to work.')}var R0={exports:{}};const pn=xn(Object.freeze(Object.defineProperty({__proto__:null,default:{}},Symbol.toStringTag,{value:"Module"})));var Ot;function G(){return Ot||(Ot=1,function(s,e){(function(t,r){s.exports=r()})(M,function(){var t=t||function(r,n){var a;if(typeof window!="undefined"&&window.crypto&&(a=window.crypto),typeof self!="undefined"&&self.crypto&&(a=self.crypto),typeof globalThis!="undefined"&&globalThis.crypto&&(a=globalThis.crypto),!a&&typeof window!="undefined"&&window.msCrypto&&(a=window.msCrypto),!a&&typeof M!="undefined"&&M.crypto&&(a=M.crypto),!a&&typeof vn=="function")try{a=pn}catch(g){}var d=function(){if(a){if(typeof a.getRandomValues=="function")try{return a.getRandomValues(new Uint32Array(1))[0]}catch(g){}if(typeof a.randomBytes=="function")try{return a.randomBytes(4).readInt32LE()}catch(g){}}throw new Error("Native crypto module could not be used to get secure random number.")},c=Object.create||function(){function g(){}return function(p){var b;return g.prototype=p,b=new g,g.prototype=null,b}}(),x={},i=x.lib={},l=i.Base=function(){return{extend:function(g){var p=c(this);return g&&p.mixIn(g),(!p.hasOwnProperty("init")||this.init===p.init)&&(p.init=function(){p.$super.init.apply(this,arguments)}),p.init.prototype=p,p.$super=this,p},create:function(){var g=this.extend();return g.init.apply(g,arguments),g},init:function(){},mixIn:function(g){for(var p in g)g.hasOwnProperty(p)&&(this[p]=g[p]);g.hasOwnProperty("toString")&&(this.toString=g.toString)},clone:function(){return this.init.prototype.extend(this)}}}(),w=i.WordArray=l.extend({init:function(g,p){g=this.words=g||[],p!=n?this.sigBytes=p:this.sigBytes=g.length*4},toString:function(g){return(g||h).stringify(this)},concat:function(g){var p=this.words,b=g.words,_=this.sigBytes,R=g.sigBytes;if(this.clamp(),_%4)for(var k=0;k<R;k++){var S=b[k>>>2]>>>24-k%4*8&255;p[_+k>>>2]|=S<<24-(_+k)%4*8}else for(var P=0;P<R;P+=4)p[_+P>>>2]=b[P>>>2];return this.sigBytes+=R,this},clamp:function(){var g=this.words,p=this.sigBytes;g[p>>>2]&=4294967295<<32-p%4*8,g.length=r.ceil(p/4)},clone:function(){var g=l.clone.call(this);return g.words=this.words.slice(0),g},random:function(g){for(var p=[],b=0;b<g;b+=4)p.push(d());return new w.init(p,g)}}),o=x.enc={},h=o.Hex={stringify:function(g){for(var p=g.words,b=g.sigBytes,_=[],R=0;R<b;R++){var k=p[R>>>2]>>>24-R%4*8&255;_.push((k>>>4).toString(16)),_.push((k&15).toString(16))}return _.join("")},parse:function(g){for(var p=g.length,b=[],_=0;_<p;_+=2)b[_>>>3]|=parseInt(g.substr(_,2),16)<<24-_%8*4;return new w.init(b,p/2)}},u=o.Latin1={stringify:function(g){for(var p=g.words,b=g.sigBytes,_=[],R=0;R<b;R++){var k=p[R>>>2]>>>24-R%4*8&255;_.push(String.fromCharCode(k))}return _.join("")},parse:function(g){for(var p=g.length,b=[],_=0;_<p;_++)b[_>>>2]|=(g.charCodeAt(_)&255)<<24-_%4*8;return new w.init(b,p)}},f=o.Utf8={stringify:function(g){try{return decodeURIComponent(escape(u.stringify(g)))}catch(p){throw new Error("Malformed UTF-8 data")}},parse:function(g){return u.parse(unescape(encodeURIComponent(g)))}},v=i.BufferedBlockAlgorithm=l.extend({reset:function(){this._data=new w.init,this._nDataBytes=0},_append:function(g){typeof g=="string"&&(g=f.parse(g)),this._data.concat(g),this._nDataBytes+=g.sigBytes},_process:function(g){var p,b=this._data,_=b.words,R=b.sigBytes,k=this.blockSize,S=k*4,P=R/S;g?P=r.ceil(P):P=r.max((P|0)-this._minBufferSize,0);var m=P*k,C=r.min(m*4,R);if(m){for(var A=0;A<m;A+=k)this._doProcessBlock(_,A);p=_.splice(0,m),b.sigBytes-=C}return new w.init(p,C)},clone:function(){var g=l.clone.call(this);return g._data=this._data.clone(),g},_minBufferSize:0});i.Hasher=v.extend({cfg:l.extend(),init:function(g){this.cfg=this.cfg.extend(g),this.reset()},reset:function(){v.reset.call(this),this._doReset()},update:function(g){return this._append(g),this._process(),this},finalize:function(g){g&&this._append(g);var p=this._doFinalize();return p},blockSize:16,_createHelper:function(g){return function(p,b){return new g.init(b).finalize(p)}},_createHmacHelper:function(g){return function(p,b){return new y.HMAC.init(g,b).finalize(p)}}});var y=x.algo={};return x}(Math);return t})}(R0)),R0.exports}var k0={exports:{}},qt;function o0(){return qt||(qt=1,function(s,e){(function(t,r){s.exports=r(G())})(M,function(t){return function(r){var n=t,a=n.lib,d=a.Base,c=a.WordArray,x=n.x64={};x.Word=d.extend({init:function(i,l){this.high=i,this.low=l}}),x.WordArray=d.extend({init:function(i,l){i=this.words=i||[],l!=r?this.sigBytes=l:this.sigBytes=i.length*8},toX32:function(){for(var i=this.words,l=i.length,w=[],o=0;o<l;o++){var h=i[o];w.push(h.high),w.push(h.low)}return c.create(w,this.sigBytes)},clone:function(){for(var i=d.clone.call(this),l=i.words=this.words.slice(0),w=l.length,o=0;o<w;o++)l[o]=l[o].clone();return i}})}(),t})}(k0)),k0.exports}var S0={exports:{}},Wt;function wn(){return Wt||(Wt=1,function(s,e){(function(t,r){s.exports=r(G())})(M,function(t){return function(){if(typeof ArrayBuffer=="function"){var r=t,n=r.lib,a=n.WordArray,d=a.init,c=a.init=function(x){if(x instanceof ArrayBuffer&&(x=new Uint8Array(x)),(x instanceof Int8Array||typeof Uint8ClampedArray!="undefined"&&x instanceof Uint8ClampedArray||x instanceof Int16Array||x instanceof Uint16Array||x instanceof Int32Array||x instanceof Uint32Array||x instanceof Float32Array||x instanceof Float64Array)&&(x=new Uint8Array(x.buffer,x.byteOffset,x.byteLength)),x instanceof Uint8Array){for(var i=x.byteLength,l=[],w=0;w<i;w++)l[w>>>2]|=x[w]<<24-w%4*8;d.call(this,l,i)}else d.apply(this,arguments)};c.prototype=a}}(),t.lib.WordArray})}(S0)),S0.exports}var B0={exports:{}},Ft;function gn(){return Ft||(Ft=1,function(s,e){(function(t,r){s.exports=r(G())})(M,function(t){return function(){var r=t,n=r.lib,a=n.WordArray,d=r.enc;d.Utf16=d.Utf16BE={stringify:function(x){for(var i=x.words,l=x.sigBytes,w=[],o=0;o<l;o+=2){var h=i[o>>>2]>>>16-o%4*8&65535;w.push(String.fromCharCode(h))}return w.join("")},parse:function(x){for(var i=x.length,l=[],w=0;w<i;w++)l[w>>>1]|=x.charCodeAt(w)<<16-w%2*16;return a.create(l,i*2)}},d.Utf16LE={stringify:function(x){for(var i=x.words,l=x.sigBytes,w=[],o=0;o<l;o+=2){var h=c(i[o>>>2]>>>16-o%4*8&65535);w.push(String.fromCharCode(h))}return w.join("")},parse:function(x){for(var i=x.length,l=[],w=0;w<i;w++)l[w>>>1]|=c(x.charCodeAt(w)<<16-w%2*16);return a.create(l,i*2)}};function c(x){return x<<8&4278255360|x>>>8&16711935}}(),t.enc.Utf16})}(B0)),B0.exports}var E0={exports:{}},Nt;function We(){return Nt||(Nt=1,function(s,e){(function(t,r){s.exports=r(G())})(M,function(t){return function(){var r=t,n=r.lib,a=n.WordArray,d=r.enc;d.Base64={stringify:function(x){var i=x.words,l=x.sigBytes,w=this._map;x.clamp();for(var o=[],h=0;h<l;h+=3)for(var u=i[h>>>2]>>>24-h%4*8&255,f=i[h+1>>>2]>>>24-(h+1)%4*8&255,v=i[h+2>>>2]>>>24-(h+2)%4*8&255,y=u<<16|f<<8|v,g=0;g<4&&h+g*.75<l;g++)o.push(w.charAt(y>>>6*(3-g)&63));var p=w.charAt(64);if(p)for(;o.length%4;)o.push(p);return o.join("")},parse:function(x){var i=x.length,l=this._map,w=this._reverseMap;if(!w){w=this._reverseMap=[];for(var o=0;o<l.length;o++)w[l.charCodeAt(o)]=o}var h=l.charAt(64);if(h){var u=x.indexOf(h);u!==-1&&(i=u)}return c(x,i,w)},_map:"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/="};function c(x,i,l){for(var w=[],o=0,h=0;h<i;h++)if(h%4){var u=l[x.charCodeAt(h-1)]<<h%4*2,f=l[x.charCodeAt(h)]>>>6-h%4*2,v=u|f;w[o>>>2]|=v<<24-o%4*8,o++}return a.create(w,o)}}(),t.enc.Base64})}(E0)),E0.exports}var A0={exports:{}},Ut;function bn(){return Ut||(Ut=1,function(s,e){(function(t,r){s.exports=r(G())})(M,function(t){return function(){var r=t,n=r.lib,a=n.WordArray,d=r.enc;d.Base64url={stringify:function(x,i=!0){var l=x.words,w=x.sigBytes,o=i?this._safe_map:this._map;x.clamp();for(var h=[],u=0;u<w;u+=3)for(var f=l[u>>>2]>>>24-u%4*8&255,v=l[u+1>>>2]>>>24-(u+1)%4*8&255,y=l[u+2>>>2]>>>24-(u+2)%4*8&255,g=f<<16|v<<8|y,p=0;p<4&&u+p*.75<w;p++)h.push(o.charAt(g>>>6*(3-p)&63));var b=o.charAt(64);if(b)for(;h.length%4;)h.push(b);return h.join("")},parse:function(x,i=!0){var l=x.length,w=i?this._safe_map:this._map,o=this._reverseMap;if(!o){o=this._reverseMap=[];for(var h=0;h<w.length;h++)o[w.charCodeAt(h)]=h}var u=w.charAt(64);if(u){var f=x.indexOf(u);f!==-1&&(l=f)}return c(x,l,o)},_map:"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/=",_safe_map:"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789-_"};function c(x,i,l){for(var w=[],o=0,h=0;h<i;h++)if(h%4){var u=l[x.charCodeAt(h-1)]<<h%4*2,f=l[x.charCodeAt(h)]>>>6-h%4*2,v=u|f;w[o>>>2]|=v<<24-o%4*8,o++}return a.create(w,o)}}(),t.enc.Base64url})}(A0)),A0.exports}var D0={exports:{}},Mt;function Fe(){return Mt||(Mt=1,function(s,e){(function(t,r){s.exports=r(G())})(M,function(t){return function(r){var n=t,a=n.lib,d=a.WordArray,c=a.Hasher,x=n.algo,i=[];(function(){for(var f=0;f<64;f++)i[f]=r.abs(r.sin(f+1))*4294967296|0})();var l=x.MD5=c.extend({_doReset:function(){this._hash=new d.init([1732584193,4023233417,2562383102,271733878])},_doProcessBlock:function(f,v){for(var y=0;y<16;y++){var g=v+y,p=f[g];f[g]=(p<<8|p>>>24)&16711935|(p<<24|p>>>8)&4278255360}var b=this._hash.words,_=f[v+0],R=f[v+1],k=f[v+2],S=f[v+3],P=f[v+4],m=f[v+5],C=f[v+6],A=f[v+7],B=f[v+8],I=f[v+9],O=f[v+10],W=f[v+11],j=f[v+12],X=f[v+13],V=f[v+14],K=f[v+15],E=b[0],H=b[1],T=b[2],D=b[3];E=w(E,H,T,D,_,7,i[0]),D=w(D,E,H,T,R,12,i[1]),T=w(T,D,E,H,k,17,i[2]),H=w(H,T,D,E,S,22,i[3]),E=w(E,H,T,D,P,7,i[4]),D=w(D,E,H,T,m,12,i[5]),T=w(T,D,E,H,C,17,i[6]),H=w(H,T,D,E,A,22,i[7]),E=w(E,H,T,D,B,7,i[8]),D=w(D,E,H,T,I,12,i[9]),T=w(T,D,E,H,O,17,i[10]),H=w(H,T,D,E,W,22,i[11]),E=w(E,H,T,D,j,7,i[12]),D=w(D,E,H,T,X,12,i[13]),T=w(T,D,E,H,V,17,i[14]),H=w(H,T,D,E,K,22,i[15]),E=o(E,H,T,D,R,5,i[16]),D=o(D,E,H,T,C,9,i[17]),T=o(T,D,E,H,W,14,i[18]),H=o(H,T,D,E,_,20,i[19]),E=o(E,H,T,D,m,5,i[20]),D=o(D,E,H,T,O,9,i[21]),T=o(T,D,E,H,K,14,i[22]),H=o(H,T,D,E,P,20,i[23]),E=o(E,H,T,D,I,5,i[24]),D=o(D,E,H,T,V,9,i[25]),T=o(T,D,E,H,S,14,i[26]),H=o(H,T,D,E,B,20,i[27]),E=o(E,H,T,D,X,5,i[28]),D=o(D,E,H,T,k,9,i[29]),T=o(T,D,E,H,A,14,i[30]),H=o(H,T,D,E,j,20,i[31]),E=h(E,H,T,D,m,4,i[32]),D=h(D,E,H,T,B,11,i[33]),T=h(T,D,E,H,W,16,i[34]),H=h(H,T,D,E,V,23,i[35]),E=h(E,H,T,D,R,4,i[36]),D=h(D,E,H,T,P,11,i[37]),T=h(T,D,E,H,A,16,i[38]),H=h(H,T,D,E,O,23,i[39]),E=h(E,H,T,D,X,4,i[40]),D=h(D,E,H,T,_,11,i[41]),T=h(T,D,E,H,S,16,i[42]),H=h(H,T,D,E,C,23,i[43]),E=h(E,H,T,D,I,4,i[44]),D=h(D,E,H,T,j,11,i[45]),T=h(T,D,E,H,K,16,i[46]),H=h(H,T,D,E,k,23,i[47]),E=u(E,H,T,D,_,6,i[48]),D=u(D,E,H,T,A,10,i[49]),T=u(T,D,E,H,V,15,i[50]),H=u(H,T,D,E,m,21,i[51]),E=u(E,H,T,D,j,6,i[52]),D=u(D,E,H,T,S,10,i[53]),T=u(T,D,E,H,O,15,i[54]),H=u(H,T,D,E,R,21,i[55]),E=u(E,H,T,D,B,6,i[56]),D=u(D,E,H,T,K,10,i[57]),T=u(T,D,E,H,C,15,i[58]),H=u(H,T,D,E,X,21,i[59]),E=u(E,H,T,D,P,6,i[60]),D=u(D,E,H,T,W,10,i[61]),T=u(T,D,E,H,k,15,i[62]),H=u(H,T,D,E,I,21,i[63]),b[0]=b[0]+E|0,b[1]=b[1]+H|0,b[2]=b[2]+T|0,b[3]=b[3]+D|0},_doFinalize:function(){var f=this._data,v=f.words,y=this._nDataBytes*8,g=f.sigBytes*8;v[g>>>5]|=128<<24-g%32;var p=r.floor(y/4294967296),b=y;v[(g+64>>>9<<4)+15]=(p<<8|p>>>24)&16711935|(p<<24|p>>>8)&4278255360,v[(g+64>>>9<<4)+14]=(b<<8|b>>>24)&16711935|(b<<24|b>>>8)&4278255360,f.sigBytes=(v.length+1)*4,this._process();for(var _=this._hash,R=_.words,k=0;k<4;k++){var S=R[k];R[k]=(S<<8|S>>>24)&16711935|(S<<24|S>>>8)&4278255360}return _},clone:function(){var f=c.clone.call(this);return f._hash=this._hash.clone(),f}});function w(f,v,y,g,p,b,_){var R=f+(v&y|~v&g)+p+_;return(R<<b|R>>>32-b)+v}function o(f,v,y,g,p,b,_){var R=f+(v&g|y&~g)+p+_;return(R<<b|R>>>32-b)+v}function h(f,v,y,g,p,b,_){var R=f+(v^y^g)+p+_;return(R<<b|R>>>32-b)+v}function u(f,v,y,g,p,b,_){var R=f+(y^(v|~g))+p+_;return(R<<b|R>>>32-b)+v}n.MD5=c._createHelper(l),n.HmacMD5=c._createHmacHelper(l)}(Math),t.MD5})}(D0)),D0.exports}var H0={exports:{}},$t;function T0(){return $t||($t=1,function(s,e){(function(t,r){s.exports=r(G())})(M,function(t){return function(){var r=t,n=r.lib,a=n.WordArray,d=n.Hasher,c=r.algo,x=[],i=c.SHA1=d.extend({_doReset:function(){this._hash=new a.init([1732584193,4023233417,2562383102,271733878,3285377520])},_doProcessBlock:function(l,w){for(var o=this._hash.words,h=o[0],u=o[1],f=o[2],v=o[3],y=o[4],g=0;g<80;g++){if(g<16)x[g]=l[w+g]|0;else{var p=x[g-3]^x[g-8]^x[g-14]^x[g-16];x[g]=p<<1|p>>>31}var b=(h<<5|h>>>27)+y+x[g];g<20?b+=(u&f|~u&v)+1518500249:g<40?b+=(u^f^v)+1859775393:g<60?b+=(u&f|u&v|f&v)-1894007588:b+=(u^f^v)-899497514,y=v,v=f,f=u<<30|u>>>2,u=h,h=b}o[0]=o[0]+h|0,o[1]=o[1]+u|0,o[2]=o[2]+f|0,o[3]=o[3]+v|0,o[4]=o[4]+y|0},_doFinalize:function(){var l=this._data,w=l.words,o=this._nDataBytes*8,h=l.sigBytes*8;return w[h>>>5]|=128<<24-h%32,w[(h+64>>>9<<4)+14]=Math.floor(o/4294967296),w[(h+64>>>9<<4)+15]=o,l.sigBytes=w.length*4,this._process(),this._hash},clone:function(){var l=d.clone.call(this);return l._hash=this._hash.clone(),l}});r.SHA1=d._createHelper(i),r.HmacSHA1=d._createHmacHelper(i)}(),t.SHA1})}(H0)),H0.exports}var P0={exports:{}},Gt;function jt(){return Gt||(Gt=1,function(s,e){(function(t,r){s.exports=r(G())})(M,function(t){return function(r){var n=t,a=n.lib,d=a.WordArray,c=a.Hasher,x=n.algo,i=[],l=[];(function(){function h(y){for(var g=r.sqrt(y),p=2;p<=g;p++)if(!(y%p))return!1;return!0}function u(y){return(y-(y|0))*4294967296|0}for(var f=2,v=0;v<64;)h(f)&&(v<8&&(i[v]=u(r.pow(f,1/2))),l[v]=u(r.pow(f,1/3)),v++),f++})();var w=[],o=x.SHA256=c.extend({_doReset:function(){this._hash=new d.init(i.slice(0))},_doProcessBlock:function(h,u){for(var f=this._hash.words,v=f[0],y=f[1],g=f[2],p=f[3],b=f[4],_=f[5],R=f[6],k=f[7],S=0;S<64;S++){if(S<16)w[S]=h[u+S]|0;else{var P=w[S-15],m=(P<<25|P>>>7)^(P<<14|P>>>18)^P>>>3,C=w[S-2],A=(C<<15|C>>>17)^(C<<13|C>>>19)^C>>>10;w[S]=m+w[S-7]+A+w[S-16]}var B=b&_^~b&R,I=v&y^v&g^y&g,O=(v<<30|v>>>2)^(v<<19|v>>>13)^(v<<10|v>>>22),W=(b<<26|b>>>6)^(b<<21|b>>>11)^(b<<7|b>>>25),j=k+W+B+l[S]+w[S],X=O+I;k=R,R=_,_=b,b=p+j|0,p=g,g=y,y=v,v=j+X|0}f[0]=f[0]+v|0,f[1]=f[1]+y|0,f[2]=f[2]+g|0,f[3]=f[3]+p|0,f[4]=f[4]+b|0,f[5]=f[5]+_|0,f[6]=f[6]+R|0,f[7]=f[7]+k|0},_doFinalize:function(){var h=this._data,u=h.words,f=this._nDataBytes*8,v=h.sigBytes*8;return u[v>>>5]|=128<<24-v%32,u[(v+64>>>9<<4)+14]=r.floor(f/4294967296),u[(v+64>>>9<<4)+15]=f,h.sigBytes=u.length*4,this._process(),this._hash},clone:function(){var h=c.clone.call(this);return h._hash=this._hash.clone(),h}});n.SHA256=c._createHelper(o),n.HmacSHA256=c._createHmacHelper(o)}(Math),t.SHA256})}(P0)),P0.exports}var z0={exports:{}},Xt;function mn(){return Xt||(Xt=1,function(s,e){(function(t,r,n){s.exports=r(G(),jt())})(M,function(t){return function(){var r=t,n=r.lib,a=n.WordArray,d=r.algo,c=d.SHA256,x=d.SHA224=c.extend({_doReset:function(){this._hash=new a.init([3238371032,914150663,812702999,4144912697,4290775857,1750603025,1694076839,3204075428])},_doFinalize:function(){var i=c._doFinalize.call(this);return i.sigBytes-=4,i}});r.SHA224=c._createHelper(x),r.HmacSHA224=c._createHmacHelper(x)}(),t.SHA224})}(z0)),z0.exports}var L0={exports:{}},Kt;function Vt(){return Kt||(Kt=1,function(s,e){(function(t,r,n){s.exports=r(G(),o0())})(M,function(t){return function(){var r=t,n=r.lib,a=n.Hasher,d=r.x64,c=d.Word,x=d.WordArray,i=r.algo;function l(){return c.create.apply(c,arguments)}var w=[l(1116352408,3609767458),l(1899447441,602891725),l(3049323471,3964484399),l(3921009573,2173295548),l(961987163,4081628472),l(1508970993,3053834265),l(2453635748,2937671579),l(2870763221,3664609560),l(3624381080,2734883394),l(310598401,1164996542),l(607225278,1323610764),l(1426881987,3590304994),l(1925078388,4068182383),l(2162078206,991336113),l(2614888103,633803317),l(3248222580,3479774868),l(3835390401,2666613458),l(4022224774,944711139),l(264347078,2341262773),l(604807628,2007800933),l(770255983,1495990901),l(1249150122,1856431235),l(1555081692,3175218132),l(1996064986,2198950837),l(2554220882,3999719339),l(2821834349,766784016),l(2952996808,2566594879),l(3210313671,3203337956),l(3336571891,1034457026),l(3584528711,2466948901),l(113926993,3758326383),l(338241895,168717936),l(666307205,1188179964),l(773529912,1546045734),l(1294757372,1522805485),l(1396182291,2643833823),l(1695183700,2343527390),l(1986661051,1014477480),l(2177026350,1206759142),l(2456956037,344077627),l(2730485921,1290863460),l(2820302411,3158454273),l(3259730800,3505952657),l(3345764771,106217008),l(3516065817,3606008344),l(3600352804,1432725776),l(4094571909,1467031594),l(275423344,851169720),l(430227734,3100823752),l(506948616,1363258195),l(659060556,3750685593),l(883997877,3785050280),l(958139571,3318307427),l(1322822218,3812723403),l(1537002063,2003034995),l(1747873779,3602036899),l(1955562222,1575990012),l(2024104815,1125592928),l(2227730452,2716904306),l(2361852424,442776044),l(2428436474,593698344),l(2756734187,3733110249),l(3204031479,2999351573),l(3329325298,3815920427),l(3391569614,3928383900),l(3515267271,566280711),l(3940187606,3454069534),l(4118630271,4000239992),l(116418474,1914138554),l(174292421,2731055270),l(289380356,3203993006),l(460393269,320620315),l(685471733,587496836),l(852142971,1086792851),l(1017036298,365543100),l(1126000580,2618297676),l(1288033470,3409855158),l(1501505948,4234509866),l(1607167915,987167468),l(1816402316,1246189591)],o=[];(function(){for(var u=0;u<80;u++)o[u]=l()})();var h=i.SHA512=a.extend({_doReset:function(){this._hash=new x.init([new c.init(1779033703,4089235720),new c.init(3144134277,2227873595),new c.init(1013904242,4271175723),new c.init(2773480762,1595750129),new c.init(1359893119,2917565137),new c.init(2600822924,725511199),new c.init(528734635,4215389547),new c.init(1541459225,327033209)])},_doProcessBlock:function(u,f){for(var v=this._hash.words,y=v[0],g=v[1],p=v[2],b=v[3],_=v[4],R=v[5],k=v[6],S=v[7],P=y.high,m=y.low,C=g.high,A=g.low,B=p.high,I=p.low,O=b.high,W=b.low,j=_.high,X=_.low,V=R.high,K=R.low,E=k.high,H=k.low,T=S.high,D=S.low,J=P,Y=m,ce=C,N=A,me=B,Ce=I,Re=O,Le=W,fe=j,ae=X,Ee=V,Ie=K,Oe=E,Ae=H,he=T,we=D,le=0;le<80;le++){var q,$,U=o[le];if(le<16)$=U.high=u[f+le*2]|0,q=U.low=u[f+le*2+1]|0;else{var te=o[le-15],F=te.high,ye=te.low,ee=(F>>>1|ye<<31)^(F>>>8|ye<<24)^F>>>7,De=(ye>>>1|F<<31)^(ye>>>8|F<<24)^(ye>>>7|F<<25),de=o[le-2],ke=de.high,He=de.low,va=(ke>>>19|He<<13)^(ke<<3|He>>>29)^ke>>>6,Vr=(He>>>19|ke<<13)^(He<<3|ke>>>29)^(He>>>6|ke<<26),Yr=o[le-7],pa=Yr.high,wa=Yr.low,Zr=o[le-16],ga=Zr.high,Qr=Zr.low;q=De+wa,$=ee+pa+(q>>>0<De>>>0?1:0),q=q+Vr,$=$+va+(q>>>0<Vr>>>0?1:0),q=q+Qr,$=$+ga+(q>>>0<Qr>>>0?1:0),U.high=$,U.low=q}var ba=fe&Ee^~fe&Oe,Jr=ae&Ie^~ae&Ae,ma=J&ce^J&me^ce&me,ya=Y&N^Y&Ce^N&Ce,_a=(J>>>28|Y<<4)^(J<<30|Y>>>2)^(J<<25|Y>>>7),en=(Y>>>28|J<<4)^(Y<<30|J>>>2)^(Y<<25|J>>>7),Ca=(fe>>>14|ae<<18)^(fe>>>18|ae<<14)^(fe<<23|ae>>>9),Ra=(ae>>>14|fe<<18)^(ae>>>18|fe<<14)^(ae<<23|fe>>>9),tn=w[le],ka=tn.high,rn=tn.low,xe=we+Ra,Te=he+Ca+(xe>>>0<we>>>0?1:0),xe=xe+Jr,Te=Te+ba+(xe>>>0<Jr>>>0?1:0),xe=xe+rn,Te=Te+ka+(xe>>>0<rn>>>0?1:0),xe=xe+q,Te=Te+$+(xe>>>0<q>>>0?1:0),nn=en+ya,Sa=_a+ma+(nn>>>0<en>>>0?1:0);he=Oe,we=Ae,Oe=Ee,Ae=Ie,Ee=fe,Ie=ae,ae=Le+xe|0,fe=Re+Te+(ae>>>0<Le>>>0?1:0)|0,Re=me,Le=Ce,me=ce,Ce=N,ce=J,N=Y,Y=xe+nn|0,J=Te+Sa+(Y>>>0<xe>>>0?1:0)|0}m=y.low=m+Y,y.high=P+J+(m>>>0<Y>>>0?1:0),A=g.low=A+N,g.high=C+ce+(A>>>0<N>>>0?1:0),I=p.low=I+Ce,p.high=B+me+(I>>>0<Ce>>>0?1:0),W=b.low=W+Le,b.high=O+Re+(W>>>0<Le>>>0?1:0),X=_.low=X+ae,_.high=j+fe+(X>>>0<ae>>>0?1:0),K=R.low=K+Ie,R.high=V+Ee+(K>>>0<Ie>>>0?1:0),H=k.low=H+Ae,k.high=E+Oe+(H>>>0<Ae>>>0?1:0),D=S.low=D+we,S.high=T+he+(D>>>0<we>>>0?1:0)},_doFinalize:function(){var u=this._data,f=u.words,v=this._nDataBytes*8,y=u.sigBytes*8;f[y>>>5]|=128<<24-y%32,f[(y+128>>>10<<5)+30]=Math.floor(v/4294967296),f[(y+128>>>10<<5)+31]=v,u.sigBytes=f.length*4,this._process();var g=this._hash.toX32();return g},clone:function(){var u=a.clone.call(this);return u._hash=this._hash.clone(),u},blockSize:1024/32});r.SHA512=a._createHelper(h),r.HmacSHA512=a._createHmacHelper(h)}(),t.SHA512})}(L0)),L0.exports}var I0={exports:{}},Yt;function yn(){return Yt||(Yt=1,function(s,e){(function(t,r,n){s.exports=r(G(),o0(),Vt())})(M,function(t){return function(){var r=t,n=r.x64,a=n.Word,d=n.WordArray,c=r.algo,x=c.SHA512,i=c.SHA384=x.extend({_doReset:function(){this._hash=new d.init([new a.init(3418070365,3238371032),new a.init(1654270250,914150663),new a.init(2438529370,812702999),new a.init(355462360,4144912697),new a.init(1731405415,4290775857),new a.init(2394180231,1750603025),new a.init(3675008525,1694076839),new a.init(1203062813,3204075428)])},_doFinalize:function(){var l=x._doFinalize.call(this);return l.sigBytes-=16,l}});r.SHA384=x._createHelper(i),r.HmacSHA384=x._createHmacHelper(i)}(),t.SHA384})}(I0)),I0.exports}var O0={exports:{}},Zt;function _n(){return Zt||(Zt=1,function(s,e){(function(t,r,n){s.exports=r(G(),o0())})(M,function(t){return function(r){var n=t,a=n.lib,d=a.WordArray,c=a.Hasher,x=n.x64,i=x.Word,l=n.algo,w=[],o=[],h=[];(function(){for(var v=1,y=0,g=0;g<24;g++){w[v+5*y]=(g+1)*(g+2)/2%64;var p=y%5,b=(2*v+3*y)%5;v=p,y=b}for(var v=0;v<5;v++)for(var y=0;y<5;y++)o[v+5*y]=y+(2*v+3*y)%5*5;for(var _=1,R=0;R<24;R++){for(var k=0,S=0,P=0;P<7;P++){if(_&1){var m=(1<<P)-1;m<32?S^=1<<m:k^=1<<m-32}_&128?_=_<<1^113:_<<=1}h[R]=i.create(k,S)}})();var u=[];(function(){for(var v=0;v<25;v++)u[v]=i.create()})();var f=l.SHA3=c.extend({cfg:c.cfg.extend({outputLength:512}),_doReset:function(){for(var v=this._state=[],y=0;y<25;y++)v[y]=new i.init;this.blockSize=(1600-2*this.cfg.outputLength)/32},_doProcessBlock:function(v,y){for(var g=this._state,p=this.blockSize/2,b=0;b<p;b++){var _=v[y+2*b],R=v[y+2*b+1];_=(_<<8|_>>>24)&16711935|(_<<24|_>>>8)&4278255360,R=(R<<8|R>>>24)&16711935|(R<<24|R>>>8)&4278255360;var k=g[b];k.high^=R,k.low^=_}for(var S=0;S<24;S++){for(var P=0;P<5;P++){for(var m=0,C=0,A=0;A<5;A++){var k=g[P+5*A];m^=k.high,C^=k.low}var B=u[P];B.high=m,B.low=C}for(var P=0;P<5;P++)for(var I=u[(P+4)%5],O=u[(P+1)%5],W=O.high,j=O.low,m=I.high^(W<<1|j>>>31),C=I.low^(j<<1|W>>>31),A=0;A<5;A++){var k=g[P+5*A];k.high^=m,k.low^=C}for(var X=1;X<25;X++){var m,C,k=g[X],V=k.high,K=k.low,E=w[X];E<32?(m=V<<E|K>>>32-E,C=K<<E|V>>>32-E):(m=K<<E-32|V>>>64-E,C=V<<E-32|K>>>64-E);var H=u[o[X]];H.high=m,H.low=C}var T=u[0],D=g[0];T.high=D.high,T.low=D.low;for(var P=0;P<5;P++)for(var A=0;A<5;A++){var X=P+5*A,k=g[X],J=u[X],Y=u[(P+1)%5+5*A],ce=u[(P+2)%5+5*A];k.high=J.high^~Y.high&ce.high,k.low=J.low^~Y.low&ce.low}var k=g[0],N=h[S];k.high^=N.high,k.low^=N.low}},_doFinalize:function(){var v=this._data,y=v.words;this._nDataBytes*8;var g=v.sigBytes*8,p=this.blockSize*32;y[g>>>5]|=1<<24-g%32,y[(r.ceil((g+1)/p)*p>>>5)-1]|=128,v.sigBytes=y.length*4,this._process();for(var b=this._state,_=this.cfg.outputLength/8,R=_/8,k=[],S=0;S<R;S++){var P=b[S],m=P.high,C=P.low;m=(m<<8|m>>>24)&16711935|(m<<24|m>>>8)&4278255360,C=(C<<8|C>>>24)&16711935|(C<<24|C>>>8)&4278255360,k.push(C),k.push(m)}return new d.init(k,_)},clone:function(){for(var v=c.clone.call(this),y=v._state=this._state.slice(0),g=0;g<25;g++)y[g]=y[g].clone();return v}});n.SHA3=c._createHelper(f),n.HmacSHA3=c._createHmacHelper(f)}(Math),t.SHA3})}(O0)),O0.exports}var q0={exports:{}},Qt;function Cn(){return Qt||(Qt=1,function(s,e){(function(t,r){s.exports=r(G())})(M,function(t){/** @preserve
  			(c) 2012 by Cédric Mesnil. All rights reserved.

  			Redistribution and use in source and binary forms, with or without modification, are permitted provided that the following conditions are met:

  			    - Redistributions of source code must retain the above copyright notice, this list of conditions and the following disclaimer.
  			    - Redistributions in binary form must reproduce the above copyright notice, this list of conditions and the following disclaimer in the documentation and/or other materials provided with the distribution.

  			THIS SOFTWARE IS PROVIDED BY THE COPYRIGHT HOLDERS AND CONTRIBUTORS "AS IS" AND ANY EXPRESS OR IMPLIED WARRANTIES, INCLUDING, BUT NOT LIMITED TO, THE IMPLIED WARRANTIES OF MERCHANTABILITY AND FITNESS FOR A PARTICULAR PURPOSE ARE DISCLAIMED. IN NO EVENT SHALL THE COPYRIGHT HOLDER OR CONTRIBUTORS BE LIABLE FOR ANY DIRECT, INDIRECT, INCIDENTAL, SPECIAL, EXEMPLARY, OR CONSEQUENTIAL DAMAGES (INCLUDING, BUT NOT LIMITED TO, PROCUREMENT OF SUBSTITUTE GOODS OR SERVICES; LOSS OF USE, DATA, OR PROFITS; OR BUSINESS INTERRUPTION) HOWEVER CAUSED AND ON ANY THEORY OF LIABILITY, WHETHER IN CONTRACT, STRICT LIABILITY, OR TORT (INCLUDING NEGLIGENCE OR OTHERWISE) ARISING IN ANY WAY OUT OF THE USE OF THIS SOFTWARE, EVEN IF ADVISED OF THE POSSIBILITY OF SUCH DAMAGE.
  			*/return function(r){var n=t,a=n.lib,d=a.WordArray,c=a.Hasher,x=n.algo,i=d.create([0,1,2,3,4,5,6,7,8,9,10,11,12,13,14,15,7,4,13,1,10,6,15,3,12,0,9,5,2,14,11,8,3,10,14,4,9,15,8,1,2,7,0,6,13,11,5,12,1,9,11,10,0,8,12,4,13,3,7,15,14,5,6,2,4,0,5,9,7,12,2,10,14,1,3,8,11,6,15,13]),l=d.create([5,14,7,0,9,2,11,4,13,6,15,8,1,10,3,12,6,11,3,7,0,13,5,10,14,15,8,12,4,9,1,2,15,5,1,3,7,14,6,9,11,8,12,2,10,0,4,13,8,6,4,1,3,11,15,0,5,12,2,13,9,7,10,14,12,15,10,4,1,5,8,7,6,2,13,14,0,3,9,11]),w=d.create([11,14,15,12,5,8,7,9,11,13,14,15,6,7,9,8,7,6,8,13,11,9,7,15,7,12,15,9,11,7,13,12,11,13,6,7,14,9,13,15,14,8,13,6,5,12,7,5,11,12,14,15,14,15,9,8,9,14,5,6,8,6,5,12,9,15,5,11,6,8,13,12,5,12,13,14,11,8,5,6]),o=d.create([8,9,9,11,13,15,15,5,7,7,8,11,14,14,12,6,9,13,15,7,12,8,9,11,7,7,12,7,6,15,13,11,9,7,15,11,8,6,6,14,12,13,5,14,13,13,7,5,15,5,8,11,14,14,6,14,6,9,12,9,12,5,15,8,8,5,12,9,12,5,14,6,8,13,6,5,15,13,11,11]),h=d.create([0,1518500249,1859775393,2400959708,2840853838]),u=d.create([1352829926,1548603684,1836072691,2053994217,0]),f=x.RIPEMD160=c.extend({_doReset:function(){this._hash=d.create([1732584193,4023233417,2562383102,271733878,3285377520])},_doProcessBlock:function(R,k){for(var S=0;S<16;S++){var P=k+S,m=R[P];R[P]=(m<<8|m>>>24)&16711935|(m<<24|m>>>8)&4278255360}var C=this._hash.words,A=h.words,B=u.words,I=i.words,O=l.words,W=w.words,j=o.words,X,V,K,E,H,T,D,J,Y,ce;T=X=C[0],D=V=C[1],J=K=C[2],Y=E=C[3],ce=H=C[4];for(var N,S=0;S<80;S+=1)N=X+R[k+I[S]]|0,S<16?N+=v(V,K,E)+A[0]:S<32?N+=y(V,K,E)+A[1]:S<48?N+=g(V,K,E)+A[2]:S<64?N+=p(V,K,E)+A[3]:N+=b(V,K,E)+A[4],N=N|0,N=_(N,W[S]),N=N+H|0,X=H,H=E,E=_(K,10),K=V,V=N,N=T+R[k+O[S]]|0,S<16?N+=b(D,J,Y)+B[0]:S<32?N+=p(D,J,Y)+B[1]:S<48?N+=g(D,J,Y)+B[2]:S<64?N+=y(D,J,Y)+B[3]:N+=v(D,J,Y)+B[4],N=N|0,N=_(N,j[S]),N=N+ce|0,T=ce,ce=Y,Y=_(J,10),J=D,D=N;N=C[1]+K+Y|0,C[1]=C[2]+E+ce|0,C[2]=C[3]+H+T|0,C[3]=C[4]+X+D|0,C[4]=C[0]+V+J|0,C[0]=N},_doFinalize:function(){var R=this._data,k=R.words,S=this._nDataBytes*8,P=R.sigBytes*8;k[P>>>5]|=128<<24-P%32,k[(P+64>>>9<<4)+14]=(S<<8|S>>>24)&16711935|(S<<24|S>>>8)&4278255360,R.sigBytes=(k.length+1)*4,this._process();for(var m=this._hash,C=m.words,A=0;A<5;A++){var B=C[A];C[A]=(B<<8|B>>>24)&16711935|(B<<24|B>>>8)&4278255360}return m},clone:function(){var R=c.clone.call(this);return R._hash=this._hash.clone(),R}});function v(R,k,S){return R^k^S}function y(R,k,S){return R&k|~R&S}function g(R,k,S){return(R|~k)^S}function p(R,k,S){return R&S|k&~S}function b(R,k,S){return R^(k|~S)}function _(R,k){return R<<k|R>>>32-k}n.RIPEMD160=c._createHelper(f),n.HmacRIPEMD160=c._createHmacHelper(f)}(),t.RIPEMD160})}(q0)),q0.exports}var W0={exports:{}},Jt;function F0(){return Jt||(Jt=1,function(s,e){(function(t,r){s.exports=r(G())})(M,function(t){(function(){var r=t,n=r.lib,a=n.Base,d=r.enc,c=d.Utf8,x=r.algo;x.HMAC=a.extend({init:function(i,l){i=this._hasher=new i.init,typeof l=="string"&&(l=c.parse(l));var w=i.blockSize,o=w*4;l.sigBytes>o&&(l=i.finalize(l)),l.clamp();for(var h=this._oKey=l.clone(),u=this._iKey=l.clone(),f=h.words,v=u.words,y=0;y<w;y++)f[y]^=1549556828,v[y]^=909522486;h.sigBytes=u.sigBytes=o,this.reset()},reset:function(){var i=this._hasher;i.reset(),i.update(this._iKey)},update:function(i){return this._hasher.update(i),this},finalize:function(i){var l=this._hasher,w=l.finalize(i);l.reset();var o=l.finalize(this._oKey.clone().concat(w));return o}})})()})}(W0)),W0.exports}var N0={exports:{}},er;function Rn(){return er||(er=1,function(s,e){(function(t,r,n){s.exports=r(G(),T0(),F0())})(M,function(t){return function(){var r=t,n=r.lib,a=n.Base,d=n.WordArray,c=r.algo,x=c.SHA1,i=c.HMAC,l=c.PBKDF2=a.extend({cfg:a.extend({keySize:128/32,hasher:x,iterations:1}),init:function(w){this.cfg=this.cfg.extend(w)},compute:function(w,o){for(var h=this.cfg,u=i.create(h.hasher,w),f=d.create(),v=d.create([1]),y=f.words,g=v.words,p=h.keySize,b=h.iterations;y.length<p;){var _=u.update(o).finalize(v);u.reset();for(var R=_.words,k=R.length,S=_,P=1;P<b;P++){S=u.finalize(S),u.reset();for(var m=S.words,C=0;C<k;C++)R[C]^=m[C]}f.concat(_),g[0]++}return f.sigBytes=p*4,f}});r.PBKDF2=function(w,o,h){return l.create(h).compute(w,o)}}(),t.PBKDF2})}(N0)),N0.exports}var U0={exports:{}},tr;function Pe(){return tr||(tr=1,function(s,e){(function(t,r,n){s.exports=r(G(),T0(),F0())})(M,function(t){return function(){var r=t,n=r.lib,a=n.Base,d=n.WordArray,c=r.algo,x=c.MD5,i=c.EvpKDF=a.extend({cfg:a.extend({keySize:128/32,hasher:x,iterations:1}),init:function(l){this.cfg=this.cfg.extend(l)},compute:function(l,w){for(var o,h=this.cfg,u=h.hasher.create(),f=d.create(),v=f.words,y=h.keySize,g=h.iterations;v.length<y;){o&&u.update(o),o=u.update(l).finalize(w),u.reset();for(var p=1;p<g;p++)o=u.finalize(o),u.reset();f.concat(o)}return f.sigBytes=y*4,f}});r.EvpKDF=function(l,w,o){return i.create(o).compute(l,w)}}(),t.EvpKDF})}(U0)),U0.exports}var M0={exports:{}},rr;function ie(){return rr||(rr=1,function(s,e){(function(t,r,n){s.exports=r(G(),Pe())})(M,function(t){t.lib.Cipher||function(r){var n=t,a=n.lib,d=a.Base,c=a.WordArray,x=a.BufferedBlockAlgorithm,i=n.enc;i.Utf8;var l=i.Base64,w=n.algo,o=w.EvpKDF,h=a.Cipher=x.extend({cfg:d.extend(),createEncryptor:function(m,C){return this.create(this._ENC_XFORM_MODE,m,C)},createDecryptor:function(m,C){return this.create(this._DEC_XFORM_MODE,m,C)},init:function(m,C,A){this.cfg=this.cfg.extend(A),this._xformMode=m,this._key=C,this.reset()},reset:function(){x.reset.call(this),this._doReset()},process:function(m){return this._append(m),this._process()},finalize:function(m){m&&this._append(m);var C=this._doFinalize();return C},keySize:128/32,ivSize:128/32,_ENC_XFORM_MODE:1,_DEC_XFORM_MODE:2,_createHelper:function(){function m(C){return typeof C=="string"?P:R}return function(C){return{encrypt:function(A,B,I){return m(B).encrypt(C,A,B,I)},decrypt:function(A,B,I){return m(B).decrypt(C,A,B,I)}}}}()});a.StreamCipher=h.extend({_doFinalize:function(){var m=this._process(!0);return m},blockSize:1});var u=n.mode={},f=a.BlockCipherMode=d.extend({createEncryptor:function(m,C){return this.Encryptor.create(m,C)},createDecryptor:function(m,C){return this.Decryptor.create(m,C)},init:function(m,C){this._cipher=m,this._iv=C}}),v=u.CBC=function(){var m=f.extend();m.Encryptor=m.extend({processBlock:function(A,B){var I=this._cipher,O=I.blockSize;C.call(this,A,B,O),I.encryptBlock(A,B),this._prevBlock=A.slice(B,B+O)}}),m.Decryptor=m.extend({processBlock:function(A,B){var I=this._cipher,O=I.blockSize,W=A.slice(B,B+O);I.decryptBlock(A,B),C.call(this,A,B,O),this._prevBlock=W}});function C(A,B,I){var O,W=this._iv;W?(O=W,this._iv=r):O=this._prevBlock;for(var j=0;j<I;j++)A[B+j]^=O[j]}return m}(),y=n.pad={},g=y.Pkcs7={pad:function(m,C){for(var A=C*4,B=A-m.sigBytes%A,I=B<<24|B<<16|B<<8|B,O=[],W=0;W<B;W+=4)O.push(I);var j=c.create(O,B);m.concat(j)},unpad:function(m){var C=m.words[m.sigBytes-1>>>2]&255;m.sigBytes-=C}};a.BlockCipher=h.extend({cfg:h.cfg.extend({mode:v,padding:g}),reset:function(){var m;h.reset.call(this);var C=this.cfg,A=C.iv,B=C.mode;this._xformMode==this._ENC_XFORM_MODE?m=B.createEncryptor:(m=B.createDecryptor,this._minBufferSize=1),this._mode&&this._mode.__creator==m?this._mode.init(this,A&&A.words):(this._mode=m.call(B,this,A&&A.words),this._mode.__creator=m)},_doProcessBlock:function(m,C){this._mode.processBlock(m,C)},_doFinalize:function(){var m,C=this.cfg.padding;return this._xformMode==this._ENC_XFORM_MODE?(C.pad(this._data,this.blockSize),m=this._process(!0)):(m=this._process(!0),C.unpad(m)),m},blockSize:128/32});var p=a.CipherParams=d.extend({init:function(m){this.mixIn(m)},toString:function(m){return(m||this.formatter).stringify(this)}}),b=n.format={},_=b.OpenSSL={stringify:function(m){var C,A=m.ciphertext,B=m.salt;return B?C=c.create([1398893684,1701076831]).concat(B).concat(A):C=A,C.toString(l)},parse:function(m){var C,A=l.parse(m),B=A.words;return B[0]==1398893684&&B[1]==1701076831&&(C=c.create(B.slice(2,4)),B.splice(0,4),A.sigBytes-=16),p.create({ciphertext:A,salt:C})}},R=a.SerializableCipher=d.extend({cfg:d.extend({format:_}),encrypt:function(m,C,A,B){B=this.cfg.extend(B);var I=m.createEncryptor(A,B),O=I.finalize(C),W=I.cfg;return p.create({ciphertext:O,key:A,iv:W.iv,algorithm:m,mode:W.mode,padding:W.padding,blockSize:m.blockSize,formatter:B.format})},decrypt:function(m,C,A,B){B=this.cfg.extend(B),C=this._parse(C,B.format);var I=m.createDecryptor(A,B).finalize(C.ciphertext);return I},_parse:function(m,C){return typeof m=="string"?C.parse(m,this):m}}),k=n.kdf={},S=k.OpenSSL={execute:function(m,C,A,B){B||(B=c.random(64/8));var I=o.create({keySize:C+A}).compute(m,B),O=c.create(I.words.slice(C),A*4);return I.sigBytes=C*4,p.create({key:I,iv:O,salt:B})}},P=a.PasswordBasedCipher=R.extend({cfg:R.cfg.extend({kdf:S}),encrypt:function(m,C,A,B){B=this.cfg.extend(B);var I=B.kdf.execute(A,m.keySize,m.ivSize);B.iv=I.iv;var O=R.encrypt.call(this,m,C,I.key,B);return O.mixIn(I),O},decrypt:function(m,C,A,B){B=this.cfg.extend(B),C=this._parse(C,B.format);var I=B.kdf.execute(A,m.keySize,m.ivSize,C.salt);B.iv=I.iv;var O=R.decrypt.call(this,m,C,I.key,B);return O}})}()})}(M0)),M0.exports}var $0={exports:{}},nr;function kn(){return nr||(nr=1,function(s,e){(function(t,r,n){s.exports=r(G(),ie())})(M,function(t){return t.mode.CFB=function(){var r=t.lib.BlockCipherMode.extend();r.Encryptor=r.extend({processBlock:function(a,d){var c=this._cipher,x=c.blockSize;n.call(this,a,d,x,c),this._prevBlock=a.slice(d,d+x)}}),r.Decryptor=r.extend({processBlock:function(a,d){var c=this._cipher,x=c.blockSize,i=a.slice(d,d+x);n.call(this,a,d,x,c),this._prevBlock=i}});function n(a,d,c,x){var i,l=this._iv;l?(i=l.slice(0),this._iv=void 0):i=this._prevBlock,x.encryptBlock(i,0);for(var w=0;w<c;w++)a[d+w]^=i[w]}return r}(),t.mode.CFB})}($0)),$0.exports}var G0={exports:{}},sr;function Sn(){return sr||(sr=1,function(s,e){(function(t,r,n){s.exports=r(G(),ie())})(M,function(t){return t.mode.CTR=function(){var r=t.lib.BlockCipherMode.extend(),n=r.Encryptor=r.extend({processBlock:function(a,d){var c=this._cipher,x=c.blockSize,i=this._iv,l=this._counter;i&&(l=this._counter=i.slice(0),this._iv=void 0);var w=l.slice(0);c.encryptBlock(w,0),l[x-1]=l[x-1]+1|0;for(var o=0;o<x;o++)a[d+o]^=w[o]}});return r.Decryptor=n,r}(),t.mode.CTR})}(G0)),G0.exports}var j0={exports:{}},ar;function Bn(){return ar||(ar=1,function(s,e){(function(t,r,n){s.exports=r(G(),ie())})(M,function(t){/** @preserve
 * Counter block mode compatible with  Dr Brian Gladman fileenc.c
 * derived from CryptoJS.mode.CTR
 * Jan Hruby jhruby.web@gmail.com
 */return t.mode.CTRGladman=function(){var r=t.lib.BlockCipherMode.extend();function n(c){if((c>>24&255)===255){var x=c>>16&255,i=c>>8&255,l=c&255;x===255?(x=0,i===255?(i=0,l===255?l=0:++l):++i):++x,c=0,c+=x<<16,c+=i<<8,c+=l}else c+=1<<24;return c}function a(c){return(c[0]=n(c[0]))===0&&(c[1]=n(c[1])),c}var d=r.Encryptor=r.extend({processBlock:function(c,x){var i=this._cipher,l=i.blockSize,w=this._iv,o=this._counter;w&&(o=this._counter=w.slice(0),this._iv=void 0),a(o);var h=o.slice(0);i.encryptBlock(h,0);for(var u=0;u<l;u++)c[x+u]^=h[u]}});return r.Decryptor=d,r}(),t.mode.CTRGladman})}(j0)),j0.exports}var X0={exports:{}},or;function En(){return or||(or=1,function(s,e){(function(t,r,n){s.exports=r(G(),ie())})(M,function(t){return t.mode.OFB=function(){var r=t.lib.BlockCipherMode.extend(),n=r.Encryptor=r.extend({processBlock:function(a,d){var c=this._cipher,x=c.blockSize,i=this._iv,l=this._keystream;i&&(l=this._keystream=i.slice(0),this._iv=void 0),c.encryptBlock(l,0);for(var w=0;w<x;w++)a[d+w]^=l[w]}});return r.Decryptor=n,r}(),t.mode.OFB})}(X0)),X0.exports}var K0={exports:{}},ir;function An(){return ir||(ir=1,function(s,e){(function(t,r,n){s.exports=r(G(),ie())})(M,function(t){return t.mode.ECB=function(){var r=t.lib.BlockCipherMode.extend();return r.Encryptor=r.extend({processBlock:function(n,a){this._cipher.encryptBlock(n,a)}}),r.Decryptor=r.extend({processBlock:function(n,a){this._cipher.decryptBlock(n,a)}}),r}(),t.mode.ECB})}(K0)),K0.exports}var V0={exports:{}},cr;function Dn(){return cr||(cr=1,function(s,e){(function(t,r,n){s.exports=r(G(),ie())})(M,function(t){return t.pad.AnsiX923={pad:function(r,n){var a=r.sigBytes,d=n*4,c=d-a%d,x=a+c-1;r.clamp(),r.words[x>>>2]|=c<<24-x%4*8,r.sigBytes+=c},unpad:function(r){var n=r.words[r.sigBytes-1>>>2]&255;r.sigBytes-=n}},t.pad.Ansix923})}(V0)),V0.exports}var Y0={exports:{}},lr;function Hn(){return lr||(lr=1,function(s,e){(function(t,r,n){s.exports=r(G(),ie())})(M,function(t){return t.pad.Iso10126={pad:function(r,n){var a=n*4,d=a-r.sigBytes%a;r.concat(t.lib.WordArray.random(d-1)).concat(t.lib.WordArray.create([d<<24],1))},unpad:function(r){var n=r.words[r.sigBytes-1>>>2]&255;r.sigBytes-=n}},t.pad.Iso10126})}(Y0)),Y0.exports}var Z0={exports:{}},ur;function Tn(){return ur||(ur=1,function(s,e){(function(t,r,n){s.exports=r(G(),ie())})(M,function(t){return t.pad.Iso97971={pad:function(r,n){r.concat(t.lib.WordArray.create([2147483648],1)),t.pad.ZeroPadding.pad(r,n)},unpad:function(r){t.pad.ZeroPadding.unpad(r),r.sigBytes--}},t.pad.Iso97971})}(Z0)),Z0.exports}var Q0={exports:{}},fr;function Pn(){return fr||(fr=1,function(s,e){(function(t,r,n){s.exports=r(G(),ie())})(M,function(t){return t.pad.ZeroPadding={pad:function(r,n){var a=n*4;r.clamp(),r.sigBytes+=a-(r.sigBytes%a||a)},unpad:function(r){for(var n=r.words,a=r.sigBytes-1,a=r.sigBytes-1;a>=0;a--)if(n[a>>>2]>>>24-a%4*8&255){r.sigBytes=a+1;break}}},t.pad.ZeroPadding})}(Q0)),Q0.exports}var J0={exports:{}},hr;function zn(){return hr||(hr=1,function(s,e){(function(t,r,n){s.exports=r(G(),ie())})(M,function(t){return t.pad.NoPadding={pad:function(){},unpad:function(){}},t.pad.NoPadding})}(J0)),J0.exports}var et={exports:{}},dr;function Ln(){return dr||(dr=1,function(s,e){(function(t,r,n){s.exports=r(G(),ie())})(M,function(t){return function(r){var n=t,a=n.lib,d=a.CipherParams,c=n.enc,x=c.Hex,i=n.format;i.Hex={stringify:function(l){return l.ciphertext.toString(x)},parse:function(l){var w=x.parse(l);return d.create({ciphertext:w})}}}(),t.format.Hex})}(et)),et.exports}var tt={exports:{}},xr;function In(){return xr||(xr=1,function(s,e){(function(t,r,n){s.exports=r(G(),We(),Fe(),Pe(),ie())})(M,function(t){return function(){var r=t,n=r.lib,a=n.BlockCipher,d=r.algo,c=[],x=[],i=[],l=[],w=[],o=[],h=[],u=[],f=[],v=[];(function(){for(var p=[],b=0;b<256;b++)b<128?p[b]=b<<1:p[b]=b<<1^283;for(var _=0,R=0,b=0;b<256;b++){var k=R^R<<1^R<<2^R<<3^R<<4;k=k>>>8^k&255^99,c[_]=k,x[k]=_;var S=p[_],P=p[S],m=p[P],C=p[k]*257^k*16843008;i[_]=C<<24|C>>>8,l[_]=C<<16|C>>>16,w[_]=C<<8|C>>>24,o[_]=C;var C=m*16843009^P*65537^S*257^_*16843008;h[k]=C<<24|C>>>8,u[k]=C<<16|C>>>16,f[k]=C<<8|C>>>24,v[k]=C,_?(_=S^p[p[p[m^S]]],R^=p[p[R]]):_=R=1}})();var y=[0,1,2,4,8,16,32,64,128,27,54],g=d.AES=a.extend({_doReset:function(){var p;if(!(this._nRounds&&this._keyPriorReset===this._key)){for(var b=this._keyPriorReset=this._key,_=b.words,R=b.sigBytes/4,k=this._nRounds=R+6,S=(k+1)*4,P=this._keySchedule=[],m=0;m<S;m++)m<R?P[m]=_[m]:(p=P[m-1],m%R?R>6&&m%R==4&&(p=c[p>>>24]<<24|c[p>>>16&255]<<16|c[p>>>8&255]<<8|c[p&255]):(p=p<<8|p>>>24,p=c[p>>>24]<<24|c[p>>>16&255]<<16|c[p>>>8&255]<<8|c[p&255],p^=y[m/R|0]<<24),P[m]=P[m-R]^p);for(var C=this._invKeySchedule=[],A=0;A<S;A++){var m=S-A;if(A%4)var p=P[m];else var p=P[m-4];A<4||m<=4?C[A]=p:C[A]=h[c[p>>>24]]^u[c[p>>>16&255]]^f[c[p>>>8&255]]^v[c[p&255]]}}},encryptBlock:function(p,b){this._doCryptBlock(p,b,this._keySchedule,i,l,w,o,c)},decryptBlock:function(p,b){var _=p[b+1];p[b+1]=p[b+3],p[b+3]=_,this._doCryptBlock(p,b,this._invKeySchedule,h,u,f,v,x);var _=p[b+1];p[b+1]=p[b+3],p[b+3]=_},_doCryptBlock:function(p,b,_,R,k,S,P,m){for(var C=this._nRounds,A=p[b]^_[0],B=p[b+1]^_[1],I=p[b+2]^_[2],O=p[b+3]^_[3],W=4,j=1;j<C;j++){var X=R[A>>>24]^k[B>>>16&255]^S[I>>>8&255]^P[O&255]^_[W++],V=R[B>>>24]^k[I>>>16&255]^S[O>>>8&255]^P[A&255]^_[W++],K=R[I>>>24]^k[O>>>16&255]^S[A>>>8&255]^P[B&255]^_[W++],E=R[O>>>24]^k[A>>>16&255]^S[B>>>8&255]^P[I&255]^_[W++];A=X,B=V,I=K,O=E}var X=(m[A>>>24]<<24|m[B>>>16&255]<<16|m[I>>>8&255]<<8|m[O&255])^_[W++],V=(m[B>>>24]<<24|m[I>>>16&255]<<16|m[O>>>8&255]<<8|m[A&255])^_[W++],K=(m[I>>>24]<<24|m[O>>>16&255]<<16|m[A>>>8&255]<<8|m[B&255])^_[W++],E=(m[O>>>24]<<24|m[A>>>16&255]<<16|m[B>>>8&255]<<8|m[I&255])^_[W++];p[b]=X,p[b+1]=V,p[b+2]=K,p[b+3]=E},keySize:256/32});r.AES=a._createHelper(g)}(),t.AES})}(tt)),tt.exports}var rt={exports:{}},vr;function On(){return vr||(vr=1,function(s,e){(function(t,r,n){s.exports=r(G(),We(),Fe(),Pe(),ie())})(M,function(t){return function(){var r=t,n=r.lib,a=n.WordArray,d=n.BlockCipher,c=r.algo,x=[57,49,41,33,25,17,9,1,58,50,42,34,26,18,10,2,59,51,43,35,27,19,11,3,60,52,44,36,63,55,47,39,31,23,15,7,62,54,46,38,30,22,14,6,61,53,45,37,29,21,13,5,28,20,12,4],i=[14,17,11,24,1,5,3,28,15,6,21,10,23,19,12,4,26,8,16,7,27,20,13,2,41,52,31,37,47,55,30,40,51,45,33,48,44,49,39,56,34,53,46,42,50,36,29,32],l=[1,2,4,6,8,10,12,14,15,17,19,21,23,25,27,28],w=[{0:8421888,268435456:32768,536870912:8421378,805306368:2,1073741824:512,1342177280:8421890,1610612736:8389122,1879048192:8388608,2147483648:514,2415919104:8389120,2684354560:33280,2952790016:8421376,3221225472:32770,3489660928:8388610,3758096384:0,4026531840:33282,134217728:0,402653184:8421890,671088640:33282,939524096:32768,1207959552:8421888,1476395008:512,1744830464:8421378,2013265920:2,2281701376:8389120,2550136832:33280,2818572288:8421376,3087007744:8389122,3355443200:8388610,3623878656:32770,3892314112:514,4160749568:8388608,1:32768,268435457:2,536870913:8421888,805306369:8388608,1073741825:8421378,1342177281:33280,1610612737:512,1879048193:8389122,2147483649:8421890,2415919105:8421376,2684354561:8388610,2952790017:33282,3221225473:514,3489660929:8389120,3758096385:32770,4026531841:0,134217729:8421890,402653185:8421376,671088641:8388608,939524097:512,1207959553:32768,1476395009:8388610,1744830465:2,2013265921:33282,2281701377:32770,2550136833:8389122,2818572289:514,3087007745:8421888,3355443201:8389120,3623878657:0,3892314113:33280,4160749569:8421378},{0:1074282512,16777216:16384,33554432:524288,50331648:1074266128,67108864:1073741840,83886080:1074282496,100663296:1073758208,117440512:16,134217728:540672,150994944:1073758224,167772160:1073741824,184549376:540688,201326592:524304,218103808:0,234881024:16400,251658240:1074266112,8388608:1073758208,25165824:540688,41943040:16,58720256:1073758224,75497472:1074282512,92274688:1073741824,109051904:524288,125829120:1074266128,142606336:524304,159383552:0,176160768:16384,192937984:1074266112,209715200:1073741840,226492416:540672,243269632:1074282496,260046848:16400,268435456:0,285212672:1074266128,301989888:1073758224,318767104:1074282496,335544320:1074266112,352321536:16,369098752:540688,385875968:16384,402653184:16400,419430400:524288,436207616:524304,452984832:1073741840,469762048:540672,486539264:1073758208,503316480:1073741824,520093696:1074282512,276824064:540688,293601280:524288,310378496:1074266112,327155712:16384,343932928:1073758208,360710144:1074282512,377487360:16,394264576:1073741824,411041792:1074282496,427819008:1073741840,444596224:1073758224,461373440:524304,478150656:0,494927872:16400,511705088:1074266128,528482304:540672},{0:260,1048576:0,2097152:67109120,3145728:65796,4194304:65540,5242880:67108868,6291456:67174660,7340032:67174400,8388608:67108864,9437184:67174656,10485760:65792,11534336:67174404,12582912:67109124,13631488:65536,14680064:4,15728640:256,524288:67174656,1572864:67174404,2621440:0,3670016:67109120,4718592:67108868,5767168:65536,6815744:65540,7864320:260,8912896:4,9961472:256,11010048:67174400,12058624:65796,13107200:65792,14155776:67109124,15204352:67174660,16252928:67108864,16777216:67174656,17825792:65540,18874368:65536,19922944:67109120,20971520:256,22020096:67174660,23068672:67108868,24117248:0,25165824:67109124,26214400:67108864,27262976:4,28311552:65792,29360128:67174400,30408704:260,31457280:65796,32505856:67174404,17301504:67108864,18350080:260,19398656:67174656,20447232:0,21495808:65540,22544384:67109120,23592960:256,24641536:67174404,25690112:65536,26738688:67174660,27787264:65796,28835840:67108868,29884416:67109124,30932992:67174400,31981568:4,33030144:65792},{0:2151682048,65536:2147487808,131072:4198464,196608:2151677952,262144:0,327680:4198400,393216:2147483712,458752:4194368,524288:2147483648,589824:4194304,655360:64,720896:2147487744,786432:2151678016,851968:4160,917504:4096,983040:2151682112,32768:2147487808,98304:64,163840:2151678016,229376:2147487744,294912:4198400,360448:2151682112,425984:0,491520:2151677952,557056:4096,622592:2151682048,688128:4194304,753664:4160,819200:2147483648,884736:4194368,950272:4198464,1015808:2147483712,1048576:4194368,1114112:4198400,1179648:2147483712,1245184:0,1310720:4160,1376256:2151678016,1441792:2151682048,1507328:2147487808,1572864:2151682112,1638400:2147483648,1703936:2151677952,1769472:4198464,1835008:2147487744,1900544:4194304,1966080:64,2031616:4096,1081344:2151677952,1146880:2151682112,1212416:0,1277952:4198400,1343488:4194368,1409024:2147483648,1474560:2147487808,1540096:64,1605632:2147483712,1671168:4096,1736704:2147487744,1802240:2151678016,1867776:4160,1933312:2151682048,1998848:4194304,2064384:4198464},{0:128,4096:17039360,8192:262144,12288:536870912,16384:537133184,20480:16777344,24576:553648256,28672:262272,32768:16777216,36864:537133056,40960:536871040,45056:553910400,49152:553910272,53248:0,57344:17039488,61440:553648128,2048:17039488,6144:553648256,10240:128,14336:17039360,18432:262144,22528:537133184,26624:553910272,30720:536870912,34816:537133056,38912:0,43008:553910400,47104:16777344,51200:536871040,55296:553648128,59392:16777216,63488:262272,65536:262144,69632:128,73728:536870912,77824:553648256,81920:16777344,86016:553910272,90112:537133184,94208:16777216,98304:553910400,102400:553648128,106496:17039360,110592:537133056,114688:262272,118784:536871040,122880:0,126976:17039488,67584:553648256,71680:16777216,75776:17039360,79872:537133184,83968:536870912,88064:17039488,92160:128,96256:553910272,100352:262272,104448:553910400,108544:0,112640:553648128,116736:16777344,120832:262144,124928:537133056,129024:536871040},{0:268435464,256:8192,512:270532608,768:270540808,1024:268443648,1280:2097152,1536:2097160,1792:268435456,2048:0,2304:268443656,2560:2105344,2816:8,3072:270532616,3328:2105352,3584:8200,3840:270540800,128:270532608,384:270540808,640:8,896:2097152,1152:2105352,1408:268435464,1664:268443648,1920:8200,2176:2097160,2432:8192,2688:268443656,2944:270532616,3200:0,3456:270540800,3712:2105344,3968:268435456,4096:268443648,4352:270532616,4608:270540808,4864:8200,5120:2097152,5376:268435456,5632:268435464,5888:2105344,6144:2105352,6400:0,6656:8,6912:270532608,7168:8192,7424:268443656,7680:270540800,7936:2097160,4224:8,4480:2105344,4736:2097152,4992:268435464,5248:268443648,5504:8200,5760:270540808,6016:270532608,6272:270540800,6528:270532616,6784:8192,7040:2105352,7296:2097160,7552:0,7808:268435456,8064:268443656},{0:1048576,16:33555457,32:1024,48:1049601,64:34604033,80:0,96:1,112:34603009,128:33555456,144:1048577,160:33554433,176:34604032,192:34603008,208:1025,224:1049600,240:33554432,8:34603009,24:0,40:33555457,56:34604032,72:1048576,88:33554433,104:33554432,120:1025,136:1049601,152:33555456,168:34603008,184:1048577,200:1024,216:34604033,232:1,248:1049600,256:33554432,272:1048576,288:33555457,304:34603009,320:1048577,336:33555456,352:34604032,368:1049601,384:1025,400:34604033,416:1049600,432:1,448:0,464:34603008,480:33554433,496:1024,264:1049600,280:33555457,296:34603009,312:1,328:33554432,344:1048576,360:1025,376:34604032,392:33554433,408:34603008,424:0,440:34604033,456:1049601,472:1024,488:33555456,504:1048577},{0:134219808,1:131072,2:134217728,3:32,4:131104,5:134350880,6:134350848,7:2048,8:134348800,9:134219776,10:133120,11:134348832,12:2080,13:0,14:134217760,15:133152,2147483648:2048,2147483649:134350880,2147483650:134219808,2147483651:134217728,2147483652:134348800,2147483653:133120,2147483654:133152,2147483655:32,2147483656:134217760,2147483657:2080,2147483658:131104,2147483659:134350848,2147483660:0,2147483661:134348832,2147483662:134219776,2147483663:131072,16:133152,17:134350848,18:32,19:2048,20:134219776,21:134217760,22:134348832,23:131072,24:0,25:131104,26:134348800,27:134219808,28:134350880,29:133120,30:2080,31:134217728,2147483664:131072,2147483665:2048,2147483666:134348832,2147483667:133152,2147483668:32,2147483669:134348800,2147483670:134217728,2147483671:134219808,2147483672:134350880,2147483673:134217760,2147483674:134219776,2147483675:0,2147483676:133120,2147483677:2080,2147483678:131104,2147483679:134350848}],o=[4160749569,528482304,33030144,2064384,129024,8064,504,2147483679],h=c.DES=d.extend({_doReset:function(){for(var y=this._key,g=y.words,p=[],b=0;b<56;b++){var _=x[b]-1;p[b]=g[_>>>5]>>>31-_%32&1}for(var R=this._subKeys=[],k=0;k<16;k++){for(var S=R[k]=[],P=l[k],b=0;b<24;b++)S[b/6|0]|=p[(i[b]-1+P)%28]<<31-b%6,S[4+(b/6|0)]|=p[28+(i[b+24]-1+P)%28]<<31-b%6;S[0]=S[0]<<1|S[0]>>>31;for(var b=1;b<7;b++)S[b]=S[b]>>>(b-1)*4+3;S[7]=S[7]<<5|S[7]>>>27}for(var m=this._invSubKeys=[],b=0;b<16;b++)m[b]=R[15-b]},encryptBlock:function(y,g){this._doCryptBlock(y,g,this._subKeys)},decryptBlock:function(y,g){this._doCryptBlock(y,g,this._invSubKeys)},_doCryptBlock:function(y,g,p){this._lBlock=y[g],this._rBlock=y[g+1],u.call(this,4,252645135),u.call(this,16,65535),f.call(this,2,858993459),f.call(this,8,16711935),u.call(this,1,1431655765);for(var b=0;b<16;b++){for(var _=p[b],R=this._lBlock,k=this._rBlock,S=0,P=0;P<8;P++)S|=w[P][((k^_[P])&o[P])>>>0];this._lBlock=k,this._rBlock=R^S}var m=this._lBlock;this._lBlock=this._rBlock,this._rBlock=m,u.call(this,1,1431655765),f.call(this,8,16711935),f.call(this,2,858993459),u.call(this,16,65535),u.call(this,4,252645135),y[g]=this._lBlock,y[g+1]=this._rBlock},keySize:64/32,ivSize:64/32,blockSize:64/32});function u(y,g){var p=(this._lBlock>>>y^this._rBlock)&g;this._rBlock^=p,this._lBlock^=p<<y}function f(y,g){var p=(this._rBlock>>>y^this._lBlock)&g;this._lBlock^=p,this._rBlock^=p<<y}r.DES=d._createHelper(h);var v=c.TripleDES=d.extend({_doReset:function(){var y=this._key,g=y.words;if(g.length!==2&&g.length!==4&&g.length<6)throw new Error("Invalid key length - 3DES requires the key length to be 64, 128, 192 or >192.");var p=g.slice(0,2),b=g.length<4?g.slice(0,2):g.slice(2,4),_=g.length<6?g.slice(0,2):g.slice(4,6);this._des1=h.createEncryptor(a.create(p)),this._des2=h.createEncryptor(a.create(b)),this._des3=h.createEncryptor(a.create(_))},encryptBlock:function(y,g){this._des1.encryptBlock(y,g),this._des2.decryptBlock(y,g),this._des3.encryptBlock(y,g)},decryptBlock:function(y,g){this._des3.decryptBlock(y,g),this._des2.encryptBlock(y,g),this._des1.decryptBlock(y,g)},keySize:192/32,ivSize:64/32,blockSize:64/32});r.TripleDES=d._createHelper(v)}(),t.TripleDES})}(rt)),rt.exports}var nt={exports:{}},pr;function qn(){return pr||(pr=1,function(s,e){(function(t,r,n){s.exports=r(G(),We(),Fe(),Pe(),ie())})(M,function(t){return function(){var r=t,n=r.lib,a=n.StreamCipher,d=r.algo,c=d.RC4=a.extend({_doReset:function(){for(var l=this._key,w=l.words,o=l.sigBytes,h=this._S=[],u=0;u<256;u++)h[u]=u;for(var u=0,f=0;u<256;u++){var v=u%o,y=w[v>>>2]>>>24-v%4*8&255;f=(f+h[u]+y)%256;var g=h[u];h[u]=h[f],h[f]=g}this._i=this._j=0},_doProcessBlock:function(l,w){l[w]^=x.call(this)},keySize:256/32,ivSize:0});function x(){for(var l=this._S,w=this._i,o=this._j,h=0,u=0;u<4;u++){w=(w+1)%256,o=(o+l[w])%256;var f=l[w];l[w]=l[o],l[o]=f,h|=l[(l[w]+l[o])%256]<<24-u*8}return this._i=w,this._j=o,h}r.RC4=a._createHelper(c);var i=d.RC4Drop=c.extend({cfg:c.cfg.extend({drop:192}),_doReset:function(){c._doReset.call(this);for(var l=this.cfg.drop;l>0;l--)x.call(this)}});r.RC4Drop=a._createHelper(i)}(),t.RC4})}(nt)),nt.exports}var st={exports:{}},wr;function Wn(){return wr||(wr=1,function(s,e){(function(t,r,n){s.exports=r(G(),We(),Fe(),Pe(),ie())})(M,function(t){return function(){var r=t,n=r.lib,a=n.StreamCipher,d=r.algo,c=[],x=[],i=[],l=d.Rabbit=a.extend({_doReset:function(){for(var o=this._key.words,h=this.cfg.iv,u=0;u<4;u++)o[u]=(o[u]<<8|o[u]>>>24)&16711935|(o[u]<<24|o[u]>>>8)&4278255360;var f=this._X=[o[0],o[3]<<16|o[2]>>>16,o[1],o[0]<<16|o[3]>>>16,o[2],o[1]<<16|o[0]>>>16,o[3],o[2]<<16|o[1]>>>16],v=this._C=[o[2]<<16|o[2]>>>16,o[0]&4294901760|o[1]&65535,o[3]<<16|o[3]>>>16,o[1]&4294901760|o[2]&65535,o[0]<<16|o[0]>>>16,o[2]&4294901760|o[3]&65535,o[1]<<16|o[1]>>>16,o[3]&4294901760|o[0]&65535];this._b=0;for(var u=0;u<4;u++)w.call(this);for(var u=0;u<8;u++)v[u]^=f[u+4&7];if(h){var y=h.words,g=y[0],p=y[1],b=(g<<8|g>>>24)&16711935|(g<<24|g>>>8)&4278255360,_=(p<<8|p>>>24)&16711935|(p<<24|p>>>8)&4278255360,R=b>>>16|_&4294901760,k=_<<16|b&65535;v[0]^=b,v[1]^=R,v[2]^=_,v[3]^=k,v[4]^=b,v[5]^=R,v[6]^=_,v[7]^=k;for(var u=0;u<4;u++)w.call(this)}},_doProcessBlock:function(o,h){var u=this._X;w.call(this),c[0]=u[0]^u[5]>>>16^u[3]<<16,c[1]=u[2]^u[7]>>>16^u[5]<<16,c[2]=u[4]^u[1]>>>16^u[7]<<16,c[3]=u[6]^u[3]>>>16^u[1]<<16;for(var f=0;f<4;f++)c[f]=(c[f]<<8|c[f]>>>24)&16711935|(c[f]<<24|c[f]>>>8)&4278255360,o[h+f]^=c[f]},blockSize:128/32,ivSize:64/32});function w(){for(var o=this._X,h=this._C,u=0;u<8;u++)x[u]=h[u];h[0]=h[0]+1295307597+this._b|0,h[1]=h[1]+3545052371+(h[0]>>>0<x[0]>>>0?1:0)|0,h[2]=h[2]+886263092+(h[1]>>>0<x[1]>>>0?1:0)|0,h[3]=h[3]+1295307597+(h[2]>>>0<x[2]>>>0?1:0)|0,h[4]=h[4]+3545052371+(h[3]>>>0<x[3]>>>0?1:0)|0,h[5]=h[5]+886263092+(h[4]>>>0<x[4]>>>0?1:0)|0,h[6]=h[6]+1295307597+(h[5]>>>0<x[5]>>>0?1:0)|0,h[7]=h[7]+3545052371+(h[6]>>>0<x[6]>>>0?1:0)|0,this._b=h[7]>>>0<x[7]>>>0?1:0;for(var u=0;u<8;u++){var f=o[u]+h[u],v=f&65535,y=f>>>16,g=((v*v>>>17)+v*y>>>15)+y*y,p=((f&4294901760)*f|0)+((f&65535)*f|0);i[u]=g^p}o[0]=i[0]+(i[7]<<16|i[7]>>>16)+(i[6]<<16|i[6]>>>16)|0,o[1]=i[1]+(i[0]<<8|i[0]>>>24)+i[7]|0,o[2]=i[2]+(i[1]<<16|i[1]>>>16)+(i[0]<<16|i[0]>>>16)|0,o[3]=i[3]+(i[2]<<8|i[2]>>>24)+i[1]|0,o[4]=i[4]+(i[3]<<16|i[3]>>>16)+(i[2]<<16|i[2]>>>16)|0,o[5]=i[5]+(i[4]<<8|i[4]>>>24)+i[3]|0,o[6]=i[6]+(i[5]<<16|i[5]>>>16)+(i[4]<<16|i[4]>>>16)|0,o[7]=i[7]+(i[6]<<8|i[6]>>>24)+i[5]|0}r.Rabbit=a._createHelper(l)}(),t.Rabbit})}(st)),st.exports}var at={exports:{}},gr;function Fn(){return gr||(gr=1,function(s,e){(function(t,r,n){s.exports=r(G(),We(),Fe(),Pe(),ie())})(M,function(t){return function(){var r=t,n=r.lib,a=n.StreamCipher,d=r.algo,c=[],x=[],i=[],l=d.RabbitLegacy=a.extend({_doReset:function(){var o=this._key.words,h=this.cfg.iv,u=this._X=[o[0],o[3]<<16|o[2]>>>16,o[1],o[0]<<16|o[3]>>>16,o[2],o[1]<<16|o[0]>>>16,o[3],o[2]<<16|o[1]>>>16],f=this._C=[o[2]<<16|o[2]>>>16,o[0]&4294901760|o[1]&65535,o[3]<<16|o[3]>>>16,o[1]&4294901760|o[2]&65535,o[0]<<16|o[0]>>>16,o[2]&4294901760|o[3]&65535,o[1]<<16|o[1]>>>16,o[3]&4294901760|o[0]&65535];this._b=0;for(var v=0;v<4;v++)w.call(this);for(var v=0;v<8;v++)f[v]^=u[v+4&7];if(h){var y=h.words,g=y[0],p=y[1],b=(g<<8|g>>>24)&16711935|(g<<24|g>>>8)&4278255360,_=(p<<8|p>>>24)&16711935|(p<<24|p>>>8)&4278255360,R=b>>>16|_&4294901760,k=_<<16|b&65535;f[0]^=b,f[1]^=R,f[2]^=_,f[3]^=k,f[4]^=b,f[5]^=R,f[6]^=_,f[7]^=k;for(var v=0;v<4;v++)w.call(this)}},_doProcessBlock:function(o,h){var u=this._X;w.call(this),c[0]=u[0]^u[5]>>>16^u[3]<<16,c[1]=u[2]^u[7]>>>16^u[5]<<16,c[2]=u[4]^u[1]>>>16^u[7]<<16,c[3]=u[6]^u[3]>>>16^u[1]<<16;for(var f=0;f<4;f++)c[f]=(c[f]<<8|c[f]>>>24)&16711935|(c[f]<<24|c[f]>>>8)&4278255360,o[h+f]^=c[f]},blockSize:128/32,ivSize:64/32});function w(){for(var o=this._X,h=this._C,u=0;u<8;u++)x[u]=h[u];h[0]=h[0]+1295307597+this._b|0,h[1]=h[1]+3545052371+(h[0]>>>0<x[0]>>>0?1:0)|0,h[2]=h[2]+886263092+(h[1]>>>0<x[1]>>>0?1:0)|0,h[3]=h[3]+1295307597+(h[2]>>>0<x[2]>>>0?1:0)|0,h[4]=h[4]+3545052371+(h[3]>>>0<x[3]>>>0?1:0)|0,h[5]=h[5]+886263092+(h[4]>>>0<x[4]>>>0?1:0)|0,h[6]=h[6]+1295307597+(h[5]>>>0<x[5]>>>0?1:0)|0,h[7]=h[7]+3545052371+(h[6]>>>0<x[6]>>>0?1:0)|0,this._b=h[7]>>>0<x[7]>>>0?1:0;for(var u=0;u<8;u++){var f=o[u]+h[u],v=f&65535,y=f>>>16,g=((v*v>>>17)+v*y>>>15)+y*y,p=((f&4294901760)*f|0)+((f&65535)*f|0);i[u]=g^p}o[0]=i[0]+(i[7]<<16|i[7]>>>16)+(i[6]<<16|i[6]>>>16)|0,o[1]=i[1]+(i[0]<<8|i[0]>>>24)+i[7]|0,o[2]=i[2]+(i[1]<<16|i[1]>>>16)+(i[0]<<16|i[0]>>>16)|0,o[3]=i[3]+(i[2]<<8|i[2]>>>24)+i[1]|0,o[4]=i[4]+(i[3]<<16|i[3]>>>16)+(i[2]<<16|i[2]>>>16)|0,o[5]=i[5]+(i[4]<<8|i[4]>>>24)+i[3]|0,o[6]=i[6]+(i[5]<<16|i[5]>>>16)+(i[4]<<16|i[4]>>>16)|0,o[7]=i[7]+(i[6]<<8|i[6]>>>24)+i[5]|0}r.RabbitLegacy=a._createHelper(l)}(),t.RabbitLegacy})}(at)),at.exports}(function(s,e){(function(t,r,n){s.exports=r(G(),o0(),wn(),gn(),We(),bn(),Fe(),T0(),jt(),mn(),Vt(),yn(),_n(),Cn(),F0(),Rn(),Pe(),ie(),kn(),Sn(),Bn(),En(),An(),Dn(),Hn(),Tn(),Pn(),zn(),Ln(),In(),On(),qn(),Wn(),Fn())})(M,function(t){return t})})(It);const br=It.exports;function Nn(s){let e=s.query?`${s.path}?${s.query}
`:`${s.path}
`;return s.body&&(e+=s.body),e}function ot(s){let e;try{e=new URL(s.path).pathname}catch(d){e=s.path}let t=Nn(be(Z({},s),{path:e}));const n=br.HmacSHA1(t,s.appSalt).toString(br.enc.Base64);let a=`QApp ${s.appID}:${n}`;return a=a.replace(/\//g,"_"),a=a.replace(/\+/g,"-"),a}const Un=new URL(g0).hostname;function Mn(s,e,t){return z(this,null,function*(){var x;const n=Pt({name:e,type:"A"}),a=ot({appID:t.appID,appSalt:t.appSalt,path:g0,query:n}),d=yield fetch(`${g0}?${n}`,{headers:{Authorization:a}});if(s.set("dnsResolveStatus",d.status),s.set("dnsResolveReqID",(x=d.headers.get("x-reqid"))!=null?x:""),s.set("dnsResolveConnectionAt",Date.now()),s.set("dnsResolveServiceDomain",Un),!d.ok)throw new Error(`Call resolve API failed, status: ${d.status} ${d.statusText}`);return yield d.json()})}class $n{constructor(e){this.logger=e}log(e){return this.logger.log("DnsResolveLog",e)}}function Xe(){const s="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789-_",e=s.length;let t="";for(let r=0;r<20;r++)t+=s[Math.floor(Math.random()*e)];return t}function mr(s,e){const t={};return Object.keys(s).forEach(r=>{t[r]=e(s[r])}),t}class yr extends Error{constructor(){super(...arguments);L(this,"name","TimeoutError")}}function it(s,e){return new Promise((t,r)=>{setTimeout(()=>r(new yr(e+" timeout")),s)})}class Gn extends Error{constructor(){super(...arguments);L(this,"name","AbortError")}}function Ke(s){return new Promise((e,t)=>{s.aborted?t(s.reason):s.addEventListener("abort",()=>{t(s.reason)})})}function _r(s,e){e.aborted?s.abort(e.reason):e.addEventListener("abort",()=>{s.abort(e.reason)})}const Cr={image:[/\.(jpe?g|png|gif|webp|svg|bmp|ico|tiff|avif|svga)$/],media:[/\.(3gp|aac|flac|mpe?g|mp3|mp4|m4a|m4v|m4p|oga|ogg|ogv|wav|webm|mov)$/],live:[/\.(flv|m3u8|ts|m4s)$/],other:[]};function Rr(s,e,t=["image","media","other"]){s.search="",s.hash="";const r=s.toString();return t.some(n=>{var a;return((a=e[n])!=null?a:[]).some(d=>d.test(r))})}function i0(s){const e=new URL(s);return e.search="",e.hash="",e.toString()}function Ve(s){return s instanceof Error?{err_msg:s.name,err_desc:s.message}:{err_msg:"Unknown",err_desc:s+""}}function se(s,e){return s==null||s===-1||e==null||e===-1?-1:(s-e)/1e3}function ct(s,e=80){const[t,r]=s.split(":"),n=r?parseInt(r,10):e;return[t,n]}function jn(s,e){return new URL(s,e).toString()}function c0(s){const[e]=s.split("?");return e.endsWith(".m3u8")}function kr(s){const[e]=s.split("?");return e.endsWith(".flv")}class lt{constructor(){L(this,"map",new Map)}on(e,t){var a;const n=[...(a=this.map.get(e))!=null?a:[],t];return this.map.set(e,n),()=>this.off(e,t)}once(e,t){const r=this.on(e,n=>{r(),t(n)});return r}off(e,t){var a;const n=((a=this.map.get(e))!=null?a:[]).filter(d=>d!==t);this.map.set(e,n)}emit(...e){var a;const[t,r]=e;((a=this.map.get(t))!=null?a:[]).forEach(d=>{d(r)})}dispose(){this.map.clear()}}const Xn=self,ut=ve("utils/sw/clients");class Kn{constructor(e=Xn){L(this,"clientIds",[]);L(this,"removed",new Set);L(this,"emitter",new lt);this.swScope=e}add(e){this.clientIds.includes(e)||this.removed.has(e)||(this.clientIds.push(e),ut("add",e,this.clientIds))}remove(e){const t=this.clientIds.indexOf(e);t<0||(this.clientIds.splice(t,1),this.removed.add(e),this.emitter.emit("remove",e),ut("remove",e,this.clientIds))}set(e){const t=this.clientIds,r=[],n=[];t.forEach(a=>{const d=e.indexOf(a);d>=0?(r.push(a),e.splice(d,1)):n.push(a)}),this.clientIds=[...r,...e],n.forEach(a=>{this.emitter.emit("remove",a)}),(n.length>0||e.length>0)&&ut("set",this.clientIds)}getAllIds(){return this.clientIds}getAll(){return z(this,null,function*(){const e=(yield this.swScope.clients.matchAll({type:"window"})).slice();return e.reverse(),this.set(e.map(t=>t.id)),this.clientIds.map(t=>e.find(r=>r.id===t))})}get(e){return z(this,null,function*(){const t=yield this.swScope.clients.get(e);return t!=null?this.add(e):this.remove(e),t})}onRemove(e){return this.emitter.on("remove",e)}whenRemoved(e,t){if(!this.clientIds.includes(e))return;const r=this.emitter.on("remove",n=>{n===e&&(r(),t())})}}const Ne=new Kn;function Vn(s){return z(this,null,function*(){const e=s.getReader();let t=new Uint8Array;for(;;){const{done:n,value:a}=yield e.read();if(n)break;t=new Uint8Array([...t,...a])}return new TextDecoder().decode(t)})}function l0(s,e){var d;const t=s.getReader(),r=(d=e[0])!=null?d:0,n=e[1];return new ReadableStream({start:c=>z(this,null,function*(){let x=0;for(;;){const{done:i,value:l}=yield t.read();if(i){c.close();break}const w=x+l.byteLength;if(w>r){let o=l;const h=r>x?r-x:0,u=n!=null&&n<w?n-x:void 0;if((h!==0||u!==void 0)&&(o=l.slice(h,u)),c.enqueue(o),n!=null&&w>=n){t.cancel("Cancelled by slice for target range met"),c.close();break}}x=w}}),cancel:c=>t.cancel(c)})}function Yn(s){let e=0;const t=new TransformStream({transform:(n,a)=>{e+=n.byteLength,a.enqueue(n)}}),r=s.pipeTo(t.writable).then(()=>({size:e,success:!0}),n=>({size:e,success:!1,error:n}));return[t.readable,r]}function Zn(s){let e,t=!1;const r=new ReadableStream({start:c=>{e=c},cancel:()=>{t=!0}}),n=s.getReader();let a=!1;return{main:new ReadableStream({start:c=>z(this,null,function*(){try{for(;;){const{value:x,done:i}=yield n.read();if(a)return;if(i){c.close(),t||e.close();return}c.enqueue(x),t||e.enqueue(x)}}catch(x){c.error(x),t||e.error(x)}}),cancel:c=>z(this,null,function*(){a=!0,yield n.cancel(c),e.error(c)})}),minor:r}}var ft={exports:{}};(function(s,e){(function(t,r){var n="1.0.2",a="",d="?",c="function",x="undefined",i="object",l="string",w="major",o="model",h="name",u="type",f="vendor",v="version",y="architecture",g="console",p="mobile",b="tablet",_="smarttv",R="wearable",k="embedded",S=255,P="Amazon",m="Apple",C="ASUS",A="BlackBerry",B="Browser",I="Chrome",O="Edge",W="Firefox",j="Google",X="Huawei",V="LG",K="Microsoft",E="Motorola",H="Opera",T="Samsung",D="Sony",J="Xiaomi",Y="Zebra",ce="Facebook",N=function(q,$){var U={};for(var te in q)$[te]&&$[te].length%2===0?U[te]=$[te].concat(q[te]):U[te]=q[te];return U},me=function(q){for(var $={},U=0;U<q.length;U++)$[q[U].toUpperCase()]=q[U];return $},Ce=function(q,$){return typeof q===l?Re($).indexOf(Re(q))!==-1:!1},Re=function(q){return q.toLowerCase()},Le=function(q){return typeof q===l?q.replace(/[^\d\.]/g,a).split(".")[0]:r},fe=function(q,$){if(typeof q===l)return q=q.replace(/^\s\s*/,a).replace(/\s\s*$/,a),typeof $===x?q:q.substring(0,S)},ae=function(q,$){for(var U=0,te,F,ye,ee,De,de;U<$.length&&!De;){var ke=$[U],He=$[U+1];for(te=F=0;te<ke.length&&!De;)if(De=ke[te++].exec(q),De)for(ye=0;ye<He.length;ye++)de=De[++F],ee=He[ye],typeof ee===i&&ee.length>0?ee.length===2?typeof ee[1]==c?this[ee[0]]=ee[1].call(this,de):this[ee[0]]=ee[1]:ee.length===3?typeof ee[1]===c&&!(ee[1].exec&&ee[1].test)?this[ee[0]]=de?ee[1].call(this,de,ee[2]):r:this[ee[0]]=de?de.replace(ee[1],ee[2]):r:ee.length===4&&(this[ee[0]]=de?ee[3].call(this,de.replace(ee[1],ee[2])):r):this[ee]=de||r;U+=2}},Ee=function(q,$){for(var U in $)if(typeof $[U]===i&&$[U].length>0){for(var te=0;te<$[U].length;te++)if(Ce($[U][te],q))return U===d?r:U}else if(Ce($[U],q))return U===d?r:U;return q},Ie={"1.0":"/8","1.2":"/1","1.3":"/3","2.0":"/412","2.0.2":"/416","2.0.3":"/417","2.0.4":"/419","?":"/"},Oe={ME:"4.90","NT 3.11":"NT3.51","NT 4.0":"NT4.0",2e3:"NT 5.0",XP:["NT 5.1","NT 5.2"],Vista:"NT 6.0",7:"NT 6.1",8:"NT 6.2","8.1":"NT 6.3",10:["NT 6.4","NT 10.0"],RT:"ARM"},Ae={browser:[[/\b(?:crmo|crios)\/([\w\.]+)/i],[v,[h,"Chrome"]],[/edg(?:e|ios|a)?\/([\w\.]+)/i],[v,[h,"Edge"]],[/(opera mini)\/([-\w\.]+)/i,/(opera [mobiletab]{3,6})\b.+version\/([-\w\.]+)/i,/(opera)(?:.+version\/|[\/ ]+)([\w\.]+)/i],[h,v],[/opios[\/ ]+([\w\.]+)/i],[v,[h,H+" Mini"]],[/\bopr\/([\w\.]+)/i],[v,[h,H]],[/(kindle)\/([\w\.]+)/i,/(lunascape|maxthon|netfront|jasmine|blazer)[\/ ]?([\w\.]*)/i,/(avant |iemobile|slim)(?:browser)?[\/ ]?([\w\.]*)/i,/(ba?idubrowser)[\/ ]?([\w\.]+)/i,/(?:ms|\()(ie) ([\w\.]+)/i,/(flock|rockmelt|midori|epiphany|silk|skyfire|ovibrowser|bolt|iron|vivaldi|iridium|phantomjs|bowser|quark|qupzilla|falkon|rekonq|puffin|brave|whale|qqbrowserlite|qq)\/([-\w\.]+)/i,/(weibo)__([\d\.]+)/i],[h,v],[/(?:\buc? ?browser|(?:juc.+)ucweb)[\/ ]?([\w\.]+)/i],[v,[h,"UC"+B]],[/\bqbcore\/([\w\.]+)/i],[v,[h,"WeChat(Win) Desktop"]],[/micromessenger\/([\w\.]+)/i],[v,[h,"WeChat"]],[/konqueror\/([\w\.]+)/i],[v,[h,"Konqueror"]],[/trident.+rv[: ]([\w\.]{1,9})\b.+like gecko/i],[v,[h,"IE"]],[/yabrowser\/([\w\.]+)/i],[v,[h,"Yandex"]],[/(avast|avg)\/([\w\.]+)/i],[[h,/(.+)/,"$1 Secure "+B],v],[/\bfocus\/([\w\.]+)/i],[v,[h,W+" Focus"]],[/\bopt\/([\w\.]+)/i],[v,[h,H+" Touch"]],[/coc_coc\w+\/([\w\.]+)/i],[v,[h,"Coc Coc"]],[/dolfin\/([\w\.]+)/i],[v,[h,"Dolphin"]],[/coast\/([\w\.]+)/i],[v,[h,H+" Coast"]],[/miuibrowser\/([\w\.]+)/i],[v,[h,"MIUI "+B]],[/fxios\/([-\w\.]+)/i],[v,[h,W]],[/\bqihu|(qi?ho?o?|360)browser/i],[[h,"360 "+B]],[/(oculus|samsung|sailfish)browser\/([\w\.]+)/i],[[h,/(.+)/,"$1 "+B],v],[/(comodo_dragon)\/([\w\.]+)/i],[[h,/_/g," "],v],[/(electron)\/([\w\.]+) safari/i,/(tesla)(?: qtcarbrowser|\/(20\d\d\.[-\w\.]+))/i,/m?(qqbrowser|baiduboxapp|2345Explorer)[\/ ]?([\w\.]+)/i],[h,v],[/(metasr)[\/ ]?([\w\.]+)/i,/(lbbrowser)/i],[h],[/((?:fban\/fbios|fb_iab\/fb4a)(?!.+fbav)|;fbav\/([\w\.]+);)/i],[[h,ce],v],[/safari (line)\/([\w\.]+)/i,/\b(line)\/([\w\.]+)\/iab/i,/(chromium|instagram)[\/ ]([-\w\.]+)/i],[h,v],[/\bgsa\/([\w\.]+) .*safari\//i],[v,[h,"GSA"]],[/headlesschrome(?:\/([\w\.]+)| )/i],[v,[h,I+" Headless"]],[/ wv\).+(chrome)\/([\w\.]+)/i],[[h,I+" WebView"],v],[/droid.+ version\/([\w\.]+)\b.+(?:mobile safari|safari)/i],[v,[h,"Android "+B]],[/(chrome|omniweb|arora|[tizenoka]{5} ?browser)\/v?([\w\.]+)/i],[h,v],[/version\/([\w\.]+) .*mobile\/\w+ (safari)/i],[v,[h,"Mobile Safari"]],[/version\/([\w\.]+) .*(mobile ?safari|safari)/i],[v,h],[/webkit.+?(mobile ?safari|safari)(\/[\w\.]+)/i],[h,[v,Ee,Ie]],[/(webkit|khtml)\/([\w\.]+)/i],[h,v],[/(navigator|netscape\d?)\/([-\w\.]+)/i],[[h,"Netscape"],v],[/mobile vr; rv:([\w\.]+)\).+firefox/i],[v,[h,W+" Reality"]],[/ekiohf.+(flow)\/([\w\.]+)/i,/(swiftfox)/i,/(icedragon|iceweasel|camino|chimera|fennec|maemo browser|minimo|conkeror|klar)[\/ ]?([\w\.\+]+)/i,/(seamonkey|k-meleon|icecat|iceape|firebird|phoenix|palemoon|basilisk|waterfox)\/([-\w\.]+)$/i,/(firefox)\/([\w\.]+)/i,/(mozilla)\/([\w\.]+) .+rv\:.+gecko\/\d+/i,/(polaris|lynx|dillo|icab|doris|amaya|w3m|netsurf|sleipnir|obigo|mosaic|(?:go|ice|up)[\. ]?browser)[-\/ ]?v?([\w\.]+)/i,/(links) \(([\w\.]+)/i],[h,v]],cpu:[[/(?:(amd|x(?:(?:86|64)[-_])?|wow|win)64)[;\)]/i],[[y,"amd64"]],[/(ia32(?=;))/i],[[y,Re]],[/((?:i[346]|x)86)[;\)]/i],[[y,"ia32"]],[/\b(aarch64|arm(v?8e?l?|_?64))\b/i],[[y,"arm64"]],[/\b(arm(?:v[67])?ht?n?[fl]p?)\b/i],[[y,"armhf"]],[/windows (ce|mobile); ppc;/i],[[y,"arm"]],[/((?:ppc|powerpc)(?:64)?)(?: mac|;|\))/i],[[y,/ower/,a,Re]],[/(sun4\w)[;\)]/i],[[y,"sparc"]],[/((?:avr32|ia64(?=;))|68k(?=\))|\barm(?=v(?:[1-7]|[5-7]1)l?|;|eabi)|(?=atmel )avr|(?:irix|mips|sparc)(?:64)?\b|pa-risc)/i],[[y,Re]]],device:[[/\b(sch-i[89]0\d|shw-m380s|sm-[pt]\w{2,4}|gt-[pn]\d{2,4}|sgh-t8[56]9|nexus 10)/i],[o,[f,T],[u,b]],[/\b((?:s[cgp]h|gt|sm)-\w+|galaxy nexus)/i,/samsung[- ]([-\w]+)/i,/sec-(sgh\w+)/i],[o,[f,T],[u,p]],[/\((ip(?:hone|od)[\w ]*);/i],[o,[f,m],[u,p]],[/\((ipad);[-\w\),; ]+apple/i,/applecoremedia\/[\w\.]+ \((ipad)/i,/\b(ipad)\d\d?,\d\d?[;\]].+ios/i],[o,[f,m],[u,b]],[/\b((?:ag[rs][23]?|bah2?|sht?|btv)-a?[lw]\d{2})\b(?!.+d\/s)/i],[o,[f,X],[u,b]],[/(?:huawei|honor)([-\w ]+)[;\)]/i,/\b(nexus 6p|\w{2,4}-[atu]?[ln][01259x][012359][an]?)\b(?!.+d\/s)/i],[o,[f,X],[u,p]],[/\b(poco[\w ]+)(?: bui|\))/i,/\b; (\w+) build\/hm\1/i,/\b(hm[-_ ]?note?[_ ]?(?:\d\w)?) bui/i,/\b(redmi[\-_ ]?(?:note|k)?[\w_ ]+)(?: bui|\))/i,/\b(mi[-_ ]?(?:a\d|one|one[_ ]plus|note lte|max)?[_ ]?(?:\d?\w?)[_ ]?(?:plus|se|lite)?)(?: bui|\))/i],[[o,/_/g," "],[f,J],[u,p]],[/\b(mi[-_ ]?(?:pad)(?:[\w_ ]+))(?: bui|\))/i],[[o,/_/g," "],[f,J],[u,b]],[/; (\w+) bui.+ oppo/i,/\b(cph[12]\d{3}|p(?:af|c[al]|d\w|e[ar])[mt]\d0|x9007|a101op)\b/i],[o,[f,"OPPO"],[u,p]],[/vivo (\w+)(?: bui|\))/i,/\b(v[12]\d{3}\w?[at])(?: bui|;)/i],[o,[f,"Vivo"],[u,p]],[/\b(rmx[12]\d{3})(?: bui|;|\))/i],[o,[f,"Realme"],[u,p]],[/\b(milestone|droid(?:[2-4x]| (?:bionic|x2|pro|razr))?:?( 4g)?)\b[\w ]+build\//i,/\bmot(?:orola)?[- ](\w*)/i,/((?:moto[\w\(\) ]+|xt\d{3,4}|nexus 6)(?= bui|\)))/i],[o,[f,E],[u,p]],[/\b(mz60\d|xoom[2 ]{0,2}) build\//i],[o,[f,E],[u,b]],[/((?=lg)?[vl]k\-?\d{3}) bui| 3\.[-\w; ]{10}lg?-([06cv9]{3,4})/i],[o,[f,V],[u,b]],[/(lm(?:-?f100[nv]?|-[\w\.]+)(?= bui|\))|nexus [45])/i,/\blg[-e;\/ ]+((?!browser|netcast|android tv)\w+)/i,/\blg-?([\d\w]+) bui/i],[o,[f,V],[u,p]],[/(ideatab[-\w ]+)/i,/lenovo ?(s[56]000[-\w]+|tab(?:[\w ]+)|yt[-\d\w]{6}|tb[-\d\w]{6})/i],[o,[f,"Lenovo"],[u,b]],[/(?:maemo|nokia).*(n900|lumia \d+)/i,/nokia[-_ ]?([-\w\.]*)/i],[[o,/_/g," "],[f,"Nokia"],[u,p]],[/(pixel c)\b/i],[o,[f,j],[u,b]],[/droid.+; (pixel[\daxl ]{0,6})(?: bui|\))/i],[o,[f,j],[u,p]],[/droid.+ ([c-g]\d{4}|so[-gl]\w+|xq-a\w[4-7][12])(?= bui|\).+chrome\/(?![1-6]{0,1}\d\.))/i],[o,[f,D],[u,p]],[/sony tablet [ps]/i,/\b(?:sony)?sgp\w+(?: bui|\))/i],[[o,"Xperia Tablet"],[f,D],[u,b]],[/ (kb2005|in20[12]5|be20[12][59])\b/i,/(?:one)?(?:plus)? (a\d0\d\d)(?: b|\))/i],[o,[f,"OnePlus"],[u,p]],[/(alexa)webm/i,/(kf[a-z]{2}wi)( bui|\))/i,/(kf[a-z]+)( bui|\)).+silk\//i],[o,[f,P],[u,b]],[/((?:sd|kf)[0349hijorstuw]+)( bui|\)).+silk\//i],[[o,/(.+)/g,"Fire Phone $1"],[f,P],[u,p]],[/(playbook);[-\w\),; ]+(rim)/i],[o,f,[u,b]],[/\b((?:bb[a-f]|st[hv])100-\d)/i,/\(bb10; (\w+)/i],[o,[f,A],[u,p]],[/(?:\b|asus_)(transfo[prime ]{4,10} \w+|eeepc|slider \w+|nexus 7|padfone|p00[cj])/i],[o,[f,C],[u,b]],[/ (z[bes]6[027][012][km][ls]|zenfone \d\w?)\b/i],[o,[f,C],[u,p]],[/(nexus 9)/i],[o,[f,"HTC"],[u,b]],[/(htc)[-;_ ]{1,2}([\w ]+(?=\)| bui)|\w+)/i,/(zte)[- ]([\w ]+?)(?: bui|\/|\))/i,/(alcatel|geeksphone|nexian|panasonic|sony)[-_ ]?([-\w]*)/i],[f,[o,/_/g," "],[u,p]],[/droid.+; ([ab][1-7]-?[0178a]\d\d?)/i],[o,[f,"Acer"],[u,b]],[/droid.+; (m[1-5] note) bui/i,/\bmz-([-\w]{2,})/i],[o,[f,"Meizu"],[u,p]],[/\b(sh-?[altvz]?\d\d[a-ekm]?)/i],[o,[f,"Sharp"],[u,p]],[/(blackberry|benq|palm(?=\-)|sonyericsson|acer|asus|dell|meizu|motorola|polytron)[-_ ]?([-\w]*)/i,/(hp) ([\w ]+\w)/i,/(asus)-?(\w+)/i,/(microsoft); (lumia[\w ]+)/i,/(lenovo)[-_ ]?([-\w]+)/i,/(jolla)/i,/(oppo) ?([\w ]+) bui/i],[f,o,[u,p]],[/(archos) (gamepad2?)/i,/(hp).+(touchpad(?!.+tablet)|tablet)/i,/(kindle)\/([\w\.]+)/i,/(nook)[\w ]+build\/(\w+)/i,/(dell) (strea[kpr\d ]*[\dko])/i,/(le[- ]+pan)[- ]+(\w{1,9}) bui/i,/(trinity)[- ]*(t\d{3}) bui/i,/(gigaset)[- ]+(q\w{1,9}) bui/i,/(vodafone) ([\w ]+)(?:\)| bui)/i],[f,o,[u,b]],[/(surface duo)/i],[o,[f,K],[u,b]],[/droid [\d\.]+; (fp\du?)(?: b|\))/i],[o,[f,"Fairphone"],[u,p]],[/(u304aa)/i],[o,[f,"AT&T"],[u,p]],[/\bsie-(\w*)/i],[o,[f,"Siemens"],[u,p]],[/\b(rct\w+) b/i],[o,[f,"RCA"],[u,b]],[/\b(venue[\d ]{2,7}) b/i],[o,[f,"Dell"],[u,b]],[/\b(q(?:mv|ta)\w+) b/i],[o,[f,"Verizon"],[u,b]],[/\b(?:barnes[& ]+noble |bn[rt])([\w\+ ]*) b/i],[o,[f,"Barnes & Noble"],[u,b]],[/\b(tm\d{3}\w+) b/i],[o,[f,"NuVision"],[u,b]],[/\b(k88) b/i],[o,[f,"ZTE"],[u,b]],[/\b(nx\d{3}j) b/i],[o,[f,"ZTE"],[u,p]],[/\b(gen\d{3}) b.+49h/i],[o,[f,"Swiss"],[u,p]],[/\b(zur\d{3}) b/i],[o,[f,"Swiss"],[u,b]],[/\b((zeki)?tb.*\b) b/i],[o,[f,"Zeki"],[u,b]],[/\b([yr]\d{2}) b/i,/\b(dragon[- ]+touch |dt)(\w{5}) b/i],[[f,"Dragon Touch"],o,[u,b]],[/\b(ns-?\w{0,9}) b/i],[o,[f,"Insignia"],[u,b]],[/\b((nxa|next)-?\w{0,9}) b/i],[o,[f,"NextBook"],[u,b]],[/\b(xtreme\_)?(v(1[045]|2[015]|[3469]0|7[05])) b/i],[[f,"Voice"],o,[u,p]],[/\b(lvtel\-)?(v1[12]) b/i],[[f,"LvTel"],o,[u,p]],[/\b(ph-1) /i],[o,[f,"Essential"],[u,p]],[/\b(v(100md|700na|7011|917g).*\b) b/i],[o,[f,"Envizen"],[u,b]],[/\b(trio[-\w\. ]+) b/i],[o,[f,"MachSpeed"],[u,b]],[/\btu_(1491) b/i],[o,[f,"Rotor"],[u,b]],[/(shield[\w ]+) b/i],[o,[f,"Nvidia"],[u,b]],[/(sprint) (\w+)/i],[f,o,[u,p]],[/(kin\.[onetw]{3})/i],[[o,/\./g," "],[f,K],[u,p]],[/droid.+; (cc6666?|et5[16]|mc[239][23]x?|vc8[03]x?)\)/i],[o,[f,Y],[u,b]],[/droid.+; (ec30|ps20|tc[2-8]\d[kx])\)/i],[o,[f,Y],[u,p]],[/(ouya)/i,/(nintendo) ([wids3utch]+)/i],[f,o,[u,g]],[/droid.+; (shield) bui/i],[o,[f,"Nvidia"],[u,g]],[/(playstation [345portablevi]+)/i],[o,[f,D],[u,g]],[/\b(xbox(?: one)?(?!; xbox))[\); ]/i],[o,[f,K],[u,g]],[/smart-tv.+(samsung)/i],[f,[u,_]],[/hbbtv.+maple;(\d+)/i],[[o,/^/,"SmartTV"],[f,T],[u,_]],[/(nux; netcast.+smarttv|lg (netcast\.tv-201\d|android tv))/i],[[f,V],[u,_]],[/(apple) ?tv/i],[f,[o,m+" TV"],[u,_]],[/crkey/i],[[o,I+"cast"],[f,j],[u,_]],[/droid.+aft(\w)( bui|\))/i],[o,[f,P],[u,_]],[/\(dtv[\);].+(aquos)/i],[o,[f,"Sharp"],[u,_]],[/\b(roku)[\dx]*[\)\/]((?:dvp-)?[\d\.]*)/i,/hbbtv\/\d+\.\d+\.\d+ +\([\w ]*; *(\w[^;]*);([^;]*)/i],[[f,fe],[o,fe],[u,_]],[/\b(android tv|smart[- ]?tv|opera tv|tv; rv:)\b/i],[[u,_]],[/((pebble))app/i],[f,o,[u,R]],[/droid.+; (glass) \d/i],[o,[f,j],[u,R]],[/droid.+; (wt63?0{2,3})\)/i],[o,[f,Y],[u,R]],[/(quest( 2)?)/i],[o,[f,ce],[u,R]],[/(tesla)(?: qtcarbrowser|\/[-\w\.]+)/i],[f,[u,k]],[/droid .+?; ([^;]+?)(?: bui|\) applew).+? mobile safari/i],[o,[u,p]],[/droid .+?; ([^;]+?)(?: bui|\) applew).+?(?! mobile) safari/i],[o,[u,b]],[/\b((tablet|tab)[;\/]|focus\/\d(?!.+mobile))/i],[[u,b]],[/(phone|mobile(?:[;\/]| safari)|pda(?=.+windows ce))/i],[[u,p]],[/(android[-\w\. ]{0,9});.+buil/i],[o,[f,"Generic"]]],engine:[[/windows.+ edge\/([\w\.]+)/i],[v,[h,O+"HTML"]],[/webkit\/537\.36.+chrome\/(?!27)([\w\.]+)/i],[v,[h,"Blink"]],[/(presto)\/([\w\.]+)/i,/(webkit|trident|netfront|netsurf|amaya|lynx|w3m|goanna)\/([\w\.]+)/i,/ekioh(flow)\/([\w\.]+)/i,/(khtml|tasman|links)[\/ ]\(?([\w\.]+)/i,/(icab)[\/ ]([23]\.[\d\.]+)/i],[h,v],[/rv\:([\w\.]{1,9})\b.+(gecko)/i],[v,h]],os:[[/microsoft (windows) (vista|xp)/i],[h,v],[/(windows) nt 6\.2; (arm)/i,/(windows (?:phone(?: os)?|mobile))[\/ ]?([\d\.\w ]*)/i,/(windows)[\/ ]?([ntce\d\. ]+\w)(?!.+xbox)/i],[h,[v,Ee,Oe]],[/(win(?=3|9|n)|win 9x )([nt\d\.]+)/i],[[h,"Windows"],[v,Ee,Oe]],[/ip[honead]{2,4}\b(?:.*os ([\w]+) like mac|; opera)/i,/cfnetwork\/.+darwin/i],[[v,/_/g,"."],[h,"iOS"]],[/(mac os x) ?([\w\. ]*)/i,/(macintosh|mac_powerpc\b)(?!.+haiku)/i],[[h,"Mac OS"],[v,/_/g,"."]],[/droid ([\w\.]+)\b.+(android[- ]x86)/i],[v,h],[/(android|webos|qnx|bada|rim tablet os|maemo|meego|sailfish)[-\/ ]?([\w\.]*)/i,/(blackberry)\w*\/([\w\.]*)/i,/(tizen|kaios)[\/ ]([\w\.]+)/i,/\((series40);/i],[h,v],[/\(bb(10);/i],[v,[h,A]],[/(?:symbian ?os|symbos|s60(?=;)|series60)[-\/ ]?([\w\.]*)/i],[v,[h,"Symbian"]],[/mozilla\/[\d\.]+ \((?:mobile|tablet|tv|mobile; [\w ]+); rv:.+ gecko\/([\w\.]+)/i],[v,[h,W+" OS"]],[/web0s;.+rt(tv)/i,/\b(?:hp)?wos(?:browser)?\/([\w\.]+)/i],[v,[h,"webOS"]],[/crkey\/([\d\.]+)/i],[v,[h,I+"cast"]],[/(cros) [\w]+ ([\w\.]+\w)/i],[[h,"Chromium OS"],v],[/(nintendo|playstation) ([wids345portablevuch]+)/i,/(xbox); +xbox ([^\);]+)/i,/\b(joli|palm)\b ?(?:os)?\/?([\w\.]*)/i,/(mint)[\/\(\) ]?(\w*)/i,/(mageia|vectorlinux)[; ]/i,/([kxln]?ubuntu|debian|suse|opensuse|gentoo|arch(?= linux)|slackware|fedora|mandriva|centos|pclinuxos|red ?hat|zenwalk|linpus|raspbian|plan 9|minix|risc os|contiki|deepin|manjaro|elementary os|sabayon|linspire)(?: gnu\/linux)?(?: enterprise)?(?:[- ]linux)?(?:-gnu)?[-\/ ]?(?!chrom|package)([-\w\.]*)/i,/(hurd|linux) ?([\w\.]*)/i,/(gnu) ?([\w\.]*)/i,/\b([-frentopcghs]{0,5}bsd|dragonfly)[\/ ]?(?!amd|[ix346]{1,2}86)([\w\.]*)/i,/(haiku) (\w+)/i],[h,v],[/(sunos) ?([\w\.\d]*)/i],[[h,"Solaris"],v],[/((?:open)?solaris)[-\/ ]?([\w\.]*)/i,/(aix) ((\d)(?=\.|\)| )[\w\.])*/i,/\b(beos|os\/2|amigaos|morphos|openvms|fuchsia|hp-ux)/i,/(unix) ?([\w\.]*)/i],[h,v]]},he=function(q,$){if(typeof q===i&&($=q,q=r),!(this instanceof he))return new he(q,$).getResult();var U=q||(typeof t!==x&&t.navigator&&t.navigator.userAgent?t.navigator.userAgent:a),te=$?N(Ae,$):Ae;return this.getBrowser=function(){var F={};return F[h]=r,F[v]=r,ae.call(F,U,te.browser),F.major=Le(F.version),F},this.getCPU=function(){var F={};return F[y]=r,ae.call(F,U,te.cpu),F},this.getDevice=function(){var F={};return F[f]=r,F[o]=r,F[u]=r,ae.call(F,U,te.device),F},this.getEngine=function(){var F={};return F[h]=r,F[v]=r,ae.call(F,U,te.engine),F},this.getOS=function(){var F={};return F[h]=r,F[v]=r,ae.call(F,U,te.os),F},this.getResult=function(){return{ua:this.getUA(),browser:this.getBrowser(),engine:this.getEngine(),os:this.getOS(),device:this.getDevice(),cpu:this.getCPU()}},this.getUA=function(){return U},this.setUA=function(F){return U=typeof F===l&&F.length>S?fe(F,S):F,this},this.setUA(U),this};he.VERSION=n,he.BROWSER=me([h,v,w]),he.CPU=me([y]),he.DEVICE=me([o,f,u,g,p,_,b,R,k]),he.ENGINE=he.OS=me([h,v]),s.exports&&(e=s.exports=he),e.UAParser=he;var we=typeof t!==x&&(t.jQuery||t.Zepto);if(we&&!we.ua){var le=new he;we.ua=le.getResult(),we.ua.get=function(){return le.getUA()},we.ua.set=function(q){le.setUA(q);var $=le.getResult();for(var U in $)we.ua[U]=$[U]}}})(typeof window=="object"?window:M)})(ft,ft.exports);const ht=ft.exports;ht(navigator.userAgent);let Ye;function u0(){if(Ye!=null)return Ye;try{new Response(new ReadableStream),Ye=!0}catch(s){Ye=!1}return Ye}function Ze(){return!(typeof TransformStream=="undefined"||!u0())}class ze{constructor(e,{method:t,headers:r,signal:n,body:a}){L(this,"url");L(this,"method");L(this,"headers");L(this,"body");L(this,"signal");this.url=e,this.method=t!=null?t:"GET",this.headers=new Headers(r),this.body=a!=null?a:null,this.signal=n!=null?n:new AbortController().signal}}class _e{constructor(e,{status:t,statusText:r,headers:n,underlayer:a}){L(this,"status");L(this,"statusText");L(this,"headers");L(this,"body");L(this,"bodyReadResult");L(this,"underlayer");if(this.status=t!=null?t:200,this.statusText=r!=null?r:"",this.headers=C0(n),this.underlayer=a,e==null||!Ze())this.body=e,this.bodyReadResult=Promise.resolve({success:!0,size:0});else{const[d,c]=Yn(e);this.body=d,this.bodyReadResult=c}}}function f0(s){const{status:e,statusText:t,headers:r,body:n}=s;return new _e(n,{status:e,statusText:t,headers:r,underlayer:s})}class dt extends Error{constructor(t){super(`Unexpected HTTP status: ${t.status} ${t.statusText}`);L(this,"name","UnexpectedHttpStatusError");this.response=t}}const Qn=new lt;let Sr;typeof self!="undefined"&&(Sr=self,Sr.addEventListener("message",s=>Qn.emit("message",s)));class Jn extends Error{constructor(){super(...arguments);L(this,"name","WindowClientError")}}const es="pR0mHGTJGIoVehu/AQCGTNeY",ts=8443,rs=!0,pe=ve("http/webrtc/how");class ns{constructor(e=10*1e3,t=3*1e3){L(this,"pcMap",new Map);this.pcConnectTimeout=e,this.dcOpenTimeout=t}makePc(e,t,r){return z(this,null,function*(){if(e.aborted)throw e.reason;const n=new RTCPeerConnection,a=n.createDataChannel("test"),d=yield n.createOffer();if(a.close(),d.sdp==null)throw new Error("TODO: empty sdp");d.sdp=d.sdp.replace(/a=ice-pwd:.+/,`a=ice-pwd:${es}`),n.setLocalDescription(d);const[c,x]=ct(t,0),i=x+ts,l={type:"answer",sdp:ss(c,i,r,rs)};return n.setRemoteDescription(l),yield Promise.race([us(e,n,t),it(this.pcConnectTimeout,"PeerConnection connect")]).catch(w=>{throw n.close(),w}),n})}getPc(e,t,r){return z(this,null,function*(){if(this.pcMap.has(t)){const a=yield this.pcMap.get(t);if(a.connectionState==="connected")return a}const n=this.makePc(e,t,r);return this.pcMap.set(t,n),n.catch(a=>{this.pcMap.delete(t)}),n})}fetch(e,t,r,n){return z(this,null,function*(){pe("fetch",r.url,"with id",t);const a=new URL(r.url).host,d=yield this.getPc(r.signal,a,n);return e.set("hoWPeerConnectionConnectAt",Date.now()),yield new cs(d,e,t,r,this.dcOpenTimeout).start()})}dispose(){this.pcMap.forEach(e=>e.then(t=>t.close())),this.pcMap.clear()}}function ss(s,e,t,r=!1){const n=r?`a=candidate:2932249642 1 tcp 2130706431 ${s} ${e} typ host tcptype passive`:`a=candidate:2932249642 1 udp 2130706431 ${s} ${e} typ host`,a=Xe();return`v=0
o=- 4679586637491621141 1661250920 IN IP4 0.0.0.0
s=-
t=0 0
a=fingerprint:sha-256 ${t}
a=ice-lite
a=extmap-allow-mixed
a=group:BUNDLE 0
m=application 9 UDP/DTLS/SCTP webrtc-datachannel
c=IN IP4 0.0.0.0
a=setup:active
a=mid:0
a=sendrecv
a=sctp-port:5000
a=ice-ufrag:${a}
a=ice-pwd:uNjBwWiGCWkRpkmkjPtjAgqrUTpVqWaM
${n}
a=end-of-candidates
`}function as(s){const e=new URL(s.url),t={};s.headers.forEach((n,a)=>{t[a]=[n]});const r={method:s.method,target:e.pathname+e.search,version:"HTTP/1.1",header:t};return JSON.stringify(r)}function os(s){try{const e=JSON.parse(s);return!e.header&&e.Header&&(e.header=e.Header),e}catch(e){throw new Error("Invalid Response head")}}function Qe(s,e,t){return s.addEventListener(e,t),()=>s.removeEventListener(e,t)}function is(s,e,t){const r=[()=>{e.readyState!=="closing"&&e.readyState!=="closed"&&(pe(`close DataChannel ${s} for finish`),e.close())}];let n=!1;const a=d=>{n||(n=!0,r.forEach(c=>c()),r.length=0,d==null||d())};return new ReadableStream({start:d=>{Ke(t).catch(c=>{a(()=>d.error(c))}),r.push(Qe(e,"message",({data:c})=>{d.enqueue(c)})),r.push(Qe(e,"error",c=>{pe(`dc ${s} error`,c),a(()=>d.error(c))})),r.push(Qe(e,"closing",c=>{pe(`DataChannel ${s} closing`,c),a(()=>d.close())}))},cancel:d=>{a()}})}class cs{constructor(e,t,r,n,a){L(this,"dc");L(this,"stream");this.ctx=t,this.id=r,this.request=n,this.dcOpenTimeout=a,this.dc=e.createDataChannel(`http|${r}`),this.stream=is(this.id,this.dc,n.signal)}open(){return z(this,null,function*(){if(this.dc.readyState==="open")return;const e=[],t=()=>e.forEach(n=>n()),r=new Promise((n,a)=>{e.push(Qe(this.dc,"open",()=>{pe(`DataChannel ${this.id} opened`),n()})),e.push(Qe(this.dc,"error",()=>{pe(`DataChannel ${this.id} error`),a(new Error("DataChannel error"))}))});return Promise.race([r,it(this.dcOpenTimeout,`DataChannel ${this.id} open`),Ke(this.request.signal)]).finally(t)})}sendRequest(){return z(this,null,function*(){var n;const e=this.request;if(!["GET","HEAD"].includes(e.method))throw new Error(`TODO: Request with method ${e.method} is not supported`);if(parseInt((n=e.headers.get("Content-Length"))!=null?n:"0",10)>0)throw new Error("TODO: Request with body is not supported");const r=as(e);pe(`DataChannel ${this.id} sendRequest:`,r),this.dc.send(r)})}receiveResponse(){return z(this,null,function*(){var u;pe(`DataChannel ${this.id} receiveResponse with state: ${this.dc.readyState}`);const e=this.request,t=this.stream.getReader(),{value:r,done:n}=yield t.read();if(n)throw new Br(`Unexpected DataChannel close, resp head expected. id: ${this.id}, url: ${this.request.url}`);if(typeof r!="string")throw new Er(`Expected first message type to be string, while got ${typeof r}`);const a=os(r);pe(`DataChannel ${this.id} get respHead:`,a);const d=a.status,c=C0(mr((u=a.header)!=null?u:{},f=>f[0])),x={status:d,statusText:a.reason,headers:c},[i,l]=hn(e.method,d,e.headers,c);if(this.ctx.set("hoWStartTransferAt",Date.now()),!i){const f=new _e(null,x);return pe("DataChannel receiveResponse done with no body"),f}let w=0;const o=new ReadableStream({start:f=>{(()=>z(this,null,function*(){for(;;){const{value:v,done:y}=yield t.read();if(y){f.close();return}if(!(v instanceof ArrayBuffer))throw new Error(`Unexpected message type: ${typeof v} / ${v==null?void 0:v.constructor.name}`);if(v.byteLength===0){t.cancel("Empty message indicates resp end"),f.close();return}f.enqueue(new Uint8Array(v)),w+=v.byteLength,l!=null&&w>=l&&(t.cancel(`Body length (${l}) reached`),f.close())}}))().catch(v=>{f.error(v)})},cancel(f){pe("DataChannel bodyStream cancel:",f),t.cancel(f)}});return new _e(o,x)})}start(){return z(this,null,function*(){yield this.open(),this.ctx.set("hoWDataChannelOpenAt",Date.now());const[,e]=yield Promise.all([this.sendRequest(),this.receiveResponse()]);return e})}}class Br extends Error{constructor(){super(...arguments);L(this,"name","UnexpectedDataChannelCloseError")}}class Er extends Error{constructor(){super(...arguments);L(this,"name","UnexpectedDataChannel1stMessageError")}}class ls extends Error{constructor(){super(...arguments);L(this,"name","PeerConnectionDisconnectedError")}}function us(s,e,t){return new Promise((r,n)=>{if(e.connectionState==="connected"){r();return}const a=fs(e,"connectionstatechange",()=>{if(pe(`RTCPeerConnection ${t} connectionstatechange`,e.connectionState),["failed","closed","disconnected"].includes(e.connectionState)){n(new ls(`${t} ${e.connectionState}`)),a();return}if(e.connectionState==="connected"){r(),a();return}});Ke(s).catch(d=>{n(d),a()})})}function fs(s,e,t){return s.addEventListener(e,t),()=>s.removeEventListener(e,t)}function Ar(s,e=()=>1){if(s.length===0)return null;const t=s.map(e),r=t.reduce((a,d)=>a+d,0);let n=Math.random()*r;for(let a=0;a<t.length;a++){const d=t[a];if(n<d)return s[a];n-=d}return s[0]}function xt(s){return s&&s.name==="AbortError"}const hs=new Br().name,ds=new Er().name;function h0(s){return!(s&&[hs,ds].includes(s.name)||xt(s)||s instanceof Jn)}class vt extends Error{constructor(t){super(t+"");L(this,"name","ResolveError");this.cause=t}}class pt extends Error{constructor(){super(...arguments);L(this,"name","NoAvailableNodeError")}}class wt extends Error{constructor(t){super(t+"");L(this,"name","DoWithNodeError");this.cause=t}}class Ue extends Error{constructor(){super(...arguments);L(this,"name","LocalDNSError")}}const Je=ve("dns");class Dr{constructor(e,t,r=Mn){L(this,"cache",new Map);L(this,"logger");L(this,"fingerprints",new Map);this.app=t,this.dnsResolver=r,this.logger=new $n(e)}getFingerprint(e){const t=this.fingerprints.get(e);if(t==null)throw new Error(`No fingerprint for ${e}`);return t}getResolveResult(e,t){return z(this,null,function*(){var c,x,i,l;const r=Date.now();let n,a;try{let w;try{w=yield this.dnsResolver(e,t,this.app)}catch(f){throw console.warn("DNS resolve failed:",f),new vt(f)}if(!ps(w))throw new Ue(`Non-ECDN domain: ${t}`);if(w.groups.length===0)throw new pt(`No available group for ${t}`);const d=w,{groups:o}=d,h=n0(d,["groups"]),u=[];return o.forEach(f=>{f.elts.forEach(y=>{y.ips.forEach(g=>{this.fingerprints.set(g,y.fingerprint)})});const v=new ge;v.set(f.elts.map(y=>({key:y.id,replicas:y.replicas}))),u.push(be(Z({},f),{consistentHash:v}))}),a=be(Z({},h),{expireAt:Date.now()+w.ttl*1e3,groups:u}),a}catch(w){throw n=w,w}finally{const w=se(Date.now(),r),o=a==null?Ve(n):{err_msg:"",err_desc:""};this.logger.log(be(Z({r_id:(c=e.get("dnsResolveReqID"))!=null?c:"",ip:(x=e.get("dnsResolveServiceIP"))!=null?x:"",domain:(i=e.get("dnsResolveServiceDomain"))!=null?i:"",status_code:(l=e.get("dnsResolveStatus"))!=null?l:-1},o),{t_conn:se(e.get("dnsResolveConnectionAt"),r),t_total:w,type:1})),e.set("dnsResolveTotalTime",w)}})}resolveDomain(e,t){return z(this,null,function*(){const r=this.cache.get(t);if(r!=null){let a;try{a=yield r}catch(d){if(d instanceof Ue||d instanceof pt)throw d}if(a!=null&&a.expireAt>Date.now())return e.set("dnsResolveFromCache",!0),a;this.cache.delete(t)}const n=this.getResolveResult(e,t);return this.cache.set(t,n),n})}resolve(e,t,r=!1){return z(this,null,function*(){let n=null;return yield this.do(e,t,1,r,a=>{n=a}),n})}do(e,t,r,n,a){return z(this,null,function*(){const d=new URL(t);if(d.port!=="")throw new Error("TODO: no port");let c;Je("Resolve for",t);let{groups:x}=yield this.resolveDomain(e,d.host);Je("Resolved for",t);for(let i=0;i<r;i++){const l=Ar(x,w=>w.weight);if(l==null)break;try{Je("doWithGroup",i,t),yield xs(l,t,n,a);return}catch(w){console.warn("doWithGroup (weight:",l.weight,") failed:",w,t),h0(w)&&(x=x.filter(o=>o!==l)),c=w}}throw c=xt(c)?c:new wt(c),c})}}function xs(s,e,t,r){return z(this,null,function*(){const n=s.elts;if(n.length===0)throw new Error("Empty elt list");if(!s.consistentHash)throw new Error("no consistentHash");const a=s.consistentHash.clone();let d;for(let c=0;c<2;c++){const x=a.get(e);if(x==null)break;const i=n.find(l=>l.id===x);if(i==null)throw new Error("No available elt");try{Je("doWithElt",i.id,e),yield vs(i,e,t,r);return}catch(l){console.warn("doWithElt",i.id,"failed:",l,e),h0(l)&&a.remove(x),d=l}}throw d})}function vs(s,e,t,r){return z(this,null,function*(){let n=t?s.hosts:s.ips;if(n.length===0)throw new Error(`Empty ${t?"host":"IP"} list`);let a;for(let d=0;d<2;d++){const c=Ar(n);if(c==null)break;try{Je(`do with ${t?"host":"IP"}`,c,e),yield r(c);return}catch(x){console.warn("do job with",c,"failed:",x,e),h0(x)&&(n=n.filter(i=>i!==c)),a=x}}throw a})}function ps(s){return s.groups!=null}const ws=new URL(b0).hostname;function gs(s,e,t){return z(this,null,function*(){var c;const r={url:e,cip:""},n=ot({appID:t.appID,appSalt:t.appSalt,path:b0}),a=yield fetch(b0,{method:"POST",body:JSON.stringify(r),headers:{"Content-Type":"application/json",Authorization:n}});if(s.set("dnsResolveStatus",a.status),s.set("dnsResolveReqID",(c=a.headers.get("x-reqid"))!=null?c:""),s.set("dnsResolveConnectionAt",Date.now()),s.set("dnsResolveServiceDomain",ws),!a.ok)throw new Error(`Call Schedule API failed, status: ${a.status} ${a.statusText}`);return yield a.json()})}class bs{constructor(e){this.logger=e}log(e){return this.logger.log("LiveScheduleLog",e)}}const e0=ve("dns"),ms=60,ys=60*1e3;class Hr{constructor(e,t,r=gs,n=i0){L(this,"scheduling",new Map);L(this,"cache",new Map);L(this,"m3u8SegmentCache",new Map);L(this,"logger");this.app=t,this.scheduler=r,this.cacheUrl=n,this.logger=new bs(e)}getScheduleResult(e,t){return z(this,null,function*(){var d,c,x,i,l;const r=Date.now();let n,a;try{let w;try{w=yield this.scheduler(e,t,this.app)}catch(h){throw console.warn("Live schedule failed:",h),new vt(h)}if(w.code===1)throw new Ue(`Local DNS for ${t}`);if(w.code!==0)throw new Error(`Unexpected schedule code: ${w.code}`);const o=(d=w.ttl)!=null?d:ms;return a=be(Z({},w),{expireAt:Date.now()+o*1e3,ips:w.ips.map(h=>({addr:h,after:0})),hosts:w.hosts.map(h=>({addr:h,after:0})),ttl:o}),a}catch(w){throw n=w,w}finally{const w=se(Date.now(),r),o=a==null?Ve(n):{err_msg:"",err_desc:""};this.logger.log(be(Z({r_id:(c=e.get("dnsResolveReqID"))!=null?c:"",ip:(x=e.get("dnsResolveServiceIP"))!=null?x:"",domain:(i=e.get("dnsResolveServiceDomain"))!=null?i:"",status_code:(l=e.get("dnsResolveStatus"))!=null?l:-1},o),{t_conn:se(e.get("dnsResolveConnectionAt"),r),t_total:w,type:1})),e.set("dnsResolveTotalTime",w)}})}saveM3u8SegmentResult(e,t){return z(this,null,function*(){const r=this.cacheUrl(e),n=this.cache.get(r);if(n==null){console.warn("No schedule result for m3u8:",e);return}const a=t.map(this.cacheUrl);a.forEach(d=>{this.m3u8SegmentCache.set(d,n)}),setTimeout(()=>{a.forEach(d=>{this.m3u8SegmentCache.delete(d)})},60*1e3)})}schedule(e,t){return z(this,null,function*(){const r=this.cacheUrl(t);if(!c0(t)&&!kr(t)){const c=this.m3u8SegmentCache.get(r);if(c==null)throw new Ue("Neither m3u8 / flv URL, or m3u8 segment URL");return c}const n=this.cache.get(r);if(n!=null&&bt(n))return e.set("dnsResolveFromCache",!0),n;const a=this.scheduling.get(r);if(a!=null){let c;try{c=yield a}catch(x){if(x instanceof Ue)throw x}if(c!=null&&bt(c))return e.set("dnsResolveFromCache",!0),c;this.scheduling.delete(r)}const d=this.getScheduleResult(e,t);return e0("save scheduling for",t),this.scheduling.set(r,d),d.then(c=>{e0("save cache for",t),this.cache.set(r,c)},()=>{}),d})}hasResult(e){const t=this.cacheUrl(e),r=c0(e)||kr(e)?this.cache.get(t):this.m3u8SegmentCache.get(t);return r!=null&&bt(r)}do(e,t,r,n,a){return z(this,null,function*(){let d;e0("schedule for",t);const c=yield this.schedule(e,t),x=n?c.hosts:c.ips;e0("scheduled for",t);for(let i=0;i<r;i++){const l=_s(x);if(l==null)break;try{e0(`do with ${n?"host":"IP"}`,l,t),yield a(l.addr),c.expireAt=Date.now()+c.ttl*1e3;return}catch(w){console.warn("do job with",l.addr,"failed:",w,t),h0(w)&&(l.after=Date.now()+ys),d=w}}throw d=xt(d)?d:new wt(d),d})}}function gt(s,e=Date.now()){return s.after<e}function _s(s){for(const e of s)if(gt(e))return e;return null}function bt(s){const e=Date.now();return s.expireAt<=e?!1:s.hosts.some(t=>gt(t,e))&&s.ips.some(t=>gt(t,e))}class Cs{constructor(){L(this,"locked",!1);L(this,"waitings",[]);this.unlock=this.unlock.bind(this)}lock(){return z(this,null,function*(){return this.locked?(yield new Promise(e=>{this.waitings.push(e)}),this.unlock):(this.locked=!0,this.unlock)})}unlock(){if(this.waitings.length===0){this.locked=!1;return}this.waitings.shift()()}runExclusive(e){return z(this,null,function*(){const t=yield this.lock();try{return yield e()}catch(r){throw r}finally{t()}})}}const Tr="0.10.0";function Rs(){var n,a;const{os:s,device:e,browser:t}=ht(navigator.userAgent);let r;return typeof window!="undefined"?r=window.location:typeof self!==void 0&&(r=self.location),{os:`${s.name}_${s.version}`,browser:`${t.name}_${t.version}`,app:(n=r==null?void 0:r.host)!=null?n:"",sdk:`Web SDK v${Tr}`,dev_model:(a=e.model)!=null?a:"",dev_id:""}}const mt=200,yt=ve("log");class ks{constructor(e,t,r,n,a){L(this,"env",Pt(Rs()));L(this,"flushMutex",new Cs);L(this,"buffer",[]);this.schemaName=e,this.fetch=t,this.flushNum=r,this.flushWait=n,this.app=a}callApiLog(e){return z(this,null,function*(){const t=this.fetch;try{const r=ot({appID:this.app.appID,appSalt:this.app.appSalt,path:`${Dt}/v1/log/${this.schemaName}`}),n=yield t(new Request(`${Dt}/v1/log/${this.schemaName}`,{method:"POST",headers:{Authorization:r,"Content-Type":"text/csv","X-Env":this.env},body:Ss(e)}));if(!n.ok)throw new Error(`Unexpected response status: ${n.status} ${n.statusText}`)}catch(r){console.warn("Call log API failed:",r)}})}flush(){return z(this,null,function*(){return this.flushMutex.runExclusive(()=>z(this,null,function*(){const e=this.buffer.splice(0);if(e.length===0)return;const t=Math.ceil(e.length/mt);return Promise.all(Array.from({length:t}).map((r,n)=>this.callApiLog(e.slice(n*mt,(n+1)*mt))))}))})}tryFlush(){return z(this,null,function*(){const e=yield this.flushMutex.runExclusive(()=>{const t=this.buffer;if(t.length===0)return!1;if(t.length>=this.flushNum)return yt("buffer.length >= this.flushNum"),!0;const r=Date.now()-t[0].ts;return r>=this.flushWait*1e3?(yt("waited >= this.flushWait"),!0):this.flushWait*1e3-r});if(e===!0)return this.flush();typeof e=="number"&&setTimeout(()=>this.tryFlush(),e)})}log(e){this.buffer.push(Z({ts:Date.now()},e)),this.tryFlush()}}class _t{constructor(e,t=self.fetch,r=100,n=30){L(this,"schemaLoggers",new Map);this.appInfo=e,this.fetch=t,this.flushNum=r,this.flushWait=n}log(e,t){yt("log",e,t);let r=this.schemaLoggers.get(e);r==null&&(r=new ks(e,this.fetch,this.flushNum,this.flushWait,this.appInfo),this.schemaLoggers.set(e,r)),r.log(t)}}function Ss(s){const e=Object.keys(s[0]),t=["ts",...e.filter(a=>a!=="ts")],r=t.map(Pr).join(","),n=s.map(a=>t.map(d=>a[d]).map(d=>d!=null?d+"":"").map(Pr).join(","));return[r,...n].join(`
`)}function Pr(s){let e=s.replace(/"/g,'""');return/("|,|\n)/.test(e)&&(e='"'+e+'"'),e}class Bs{constructor(e,t){L(this,"db");this.dbName=e,this.storeNames=t}getDB(){return z(this,null,function*(){return this.db!=null?this.db:new Promise(e=>{const t=indexedDB.open(this.dbName);t.addEventListener("upgradeneeded",()=>{this.storeNames.forEach(r=>{t.result.createObjectStore(r)})}),e(d0(t))})})}get(e,t){return z(this,null,function*(){const n=(yield this.getDB()).transaction(e,"readonly").objectStore(e).get(t);return d0(n)})}getAll(e){return z(this,null,function*(){const r=(yield this.getDB()).transaction(e,"readonly").objectStore(e).getAll();return d0(r)})}count(e){return z(this,null,function*(){const r=(yield this.getDB()).transaction(e,"readonly").objectStore(e).count();return d0(r)})}set(e,t,r){return z(this,null,function*(){const a=(yield this.getDB()).transaction(e,"readwrite");return a.objectStore(e).put(r,t),Ct(a)})}remove(e,t){return z(this,null,function*(){const n=(yield this.getDB()).transaction(e,"readwrite");return n.objectStore(e).delete(t),Ct(n)})}clear(){return z(this,null,function*(){const e=yield this.getDB();yield Promise.all(this.storeNames.map(t=>{const r=e.transaction(t,"readwrite");return r.objectStore(t).clear(),Ct(r)}))})}dispose(){var e;(e=this.db)==null||e.close()}}function d0(s){return new Promise((e,t)=>{s.addEventListener("success",()=>e(s.result)),s.addEventListener("error",()=>t(s.error))})}function Ct(s){return new Promise((e,t)=>{s.addEventListener("complete",()=>e()),s.addEventListener("error",()=>t(s.error)),s.addEventListener("abort",()=>t(s.error))})}const Es=ve("dc"),zr="miku/dc",Rt="item";class As{constructor(e={}){L(this,"db",new Bs(zr,[Rt]));L(this,"browserCache",null);L(this,"browserCachePromise",null);this.config=e}openBrowserCache(){return z(this,null,function*(){return this.browserCachePromise!=null?this.browserCachePromise:(this.browserCachePromise=caches.open(zr),this.browserCachePromise.then(e=>{this.browserCache=e}),this.browserCachePromise)})}getItem(e){return z(this,null,function*(){return this.db.get(Rt,e)})}setItem(e,t){return z(this,null,function*(){Es("setItem",e,t),yield this.db.set(Rt,e,t)})}browserCacheMatch(e){return z(this,null,function*(){let t=this.browserCache;return t==null&&(t=yield this.openBrowserCache()),t.match(e)})}browserCachePut(e,t){return z(this,null,function*(){let r=this.browserCache;r==null&&(r=yield this.openBrowserCache()),yield r.put(e,t)})}getContent(e,t){return z(this,null,function*(){const r=yield this.browserCacheMatch(Lr(e,t));if(r==null)return;if(r.body==null)throw new Error("Body expected for cached response");return f0(r)})}setContent(e,t,r){return z(this,null,function*(){let n;if(!u0())n=r.underlayer;else{const{headers:a,body:d}=r;n=new Response(d,{status:200,statusText:"OK",headers:a})}yield this.browserCachePut(Lr(e,t),n)})}dispose(){this.db.dispose()}}function Lr(s,e){var t;return`${s}_with_range_${e[0]}_${(t=e[1])!=null?t:""}`}class Me{constructor(e){L(this,"value");this.value=e!=null?Z({},e.value):{}}set(e,t){this.value[e]=t}get(e){return this.value[e]}}class Ds{constructor(e){this.logger=e}log(e){return this.logger.log("DownloadLog",e)}}class Hs{constructor(e){this.logger=e}log(e){return this.logger.log("DoLog",e)}}const Ts=3,kt=ve("http");class Ir{constructor(e,t,r=0){L(this,"downloadLogger");L(this,"doLogger");this.client=t,this.clientResponseTimeout=r,this.downloadLogger=new Ds(e),this.doLogger=new Hs(e)}doWithResolved(e,t,r,n){return z(this,null,function*(){var i;const a=new URL(t.url).host,d=Date.now();let c,x;try{kt("fetch",t.url,"with resolved",r);const l=new AbortController;_r(l,t.signal);const w=new ze(t.url,be(Z({},t),{signal:l.signal}));w.headers.set("X-Miku-Agent",`web-miku/v${Tr}`);let o=this.client.fetch(e,w,r);this.clientResponseTimeout>0&&(o=Promise.race([o,it(this.clientResponseTimeout)]),o.catch(u=>{u instanceof yr&&l.abort(u)}));const h=yield o;if(kt("fetch",t.url,"succeeded with status",h.status),e.set("downloadStatus",h.status),e.set("downloadReqID",(i=h.headers.get("x-reqid"))!=null?i:""),h.status===429||h.status>=500)throw new dt(h);return x=h,x}catch(l){throw kt("fetch",t.url,"with resolved",r,"failed:",l),c=l,l}finally{const l=t.headers.get("Range"),w=l==null?null:Tt(l),o=e.get("downloadReqMessageAt"),h=e.get("downloadConnectionAt"),u=e.get("downloadStartTransferAt"),f=e.get("downloadRespMessageAt"),v=p=>{var b,_,R,k,S,P,m;return this.downloadLogger.log(Z({ip:r.split(":")[0],domain:a,range_st:(b=w==null?void 0:w.start)!=null?b:-1,range_end:(_=w==null?void 0:w.end)!=null?_:-1,retry:n,ftask_id:(R=e.get("downloadFileTaskID"))!=null?R:"",task_id:(k=e.get("taskID"))!=null?k:"",d_id:(S=e.get("doID"))!=null?S:"",ts_st:d,r_id:(P=e.get("downloadReqID"))!=null?P:"",status_code:(m=e.get("downloadStatus"))!=null?m:-1,t_req_msg:se(o,d),t_conn:se(h,o!=null?o:d),t_tls:-1,t_st_trans:se(u,h),t_resp_msg:se(f,u),err_msg:"",err_desc:"",t_content_trans:-1,t_total:-1,resp_size:-1},p))},y=p=>{const b=Date.now();v(Z({t_total:se(b,d)},Ve(p)))},g=p=>{const b=Date.now();v({t_content_trans:se(b,f!=null?f:u),t_total:se(b,d),resp_size:p})};x==null?y(c):x.bodyReadResult.then(p=>{p.success?g(p.size):y(p.error)})}})}originalDo(e,t){return z(this,null,function*(){if(t.signal.aborted)throw t.signal.reason;let r=-1,n;if(yield this.client.resolve(e,t,Ts,a=>z(this,null,function*(){r++;const d=new Me(e);n=yield this.doWithResolved(d,t,a,r)})),n==null)throw new Error(`Http do failed: resolver do finished with no finalResp, url: ${t.url}`);return n})}do(e,t){return z(this,null,function*(){const r=Date.now(),n=Xe();e.set("doID",n);let a,d=null;try{return a=yield this.originalDo(e,t),a}catch(c){throw d=c,c}finally{const{onDoError:c,onDoResponsed:x}=this.getDoLog(e,n,r);a==null?c(d):x(a.status)}})}getDoLog(e,t,r){const n=c=>{var x;return this.doLogger.log(Z({lookup_type:!0,t_lookup:(x=e.get("dnsResolveFromCache")===!0?0:e.get("dnsResolveTotalTime"))!=null?x:-1,t_total:-1,ts_st:r,err_desc:"",err_msg:"",status_code:-1,task_id:e.get("taskID"),id:t},c))};return{onDoError:c=>{const x=Date.now();n(Z({t_total:se(x,r)},Ve(c)))},onDoResponsed:c=>{const x=Date.now();n({t_total:se(x,r),status_code:c})}}}}const Ps=443;function zs(s,e){const{url:t,headers:r,method:n,redirect:a,signal:d}=s,c=new URL(t),x=c.host,[i,l]=ct(e),w=l+Ps;return c.protocol="https:",c.host=`${i}:${w}`,c.pathname=`/${x}${c.pathname}`,Or(c.toString(),{headers:r,method:n,redirect:a,signal:d})}function Or(s,e){return new Request(s,Z({mode:"cors",credentials:"omit"},e))}function qr(s,e){return z(this,null,function*(){const d=e,{url:t}=d,r=n0(d,["url"]),n=Or(t,r),a=yield fetch(n);return f0(a)})}class Ls{constructor(e){this.logger=e}log(e){return this.logger.log("TaskLog",e)}}class Wr{constructor(e,t,r,n,a){L(this,"id",Xe());L(this,"priority",0);L(this,"abortCtrl",new AbortController);L(this,"taskLogger");L(this,"started",!1);this.url=e,this.range=t,this.expiry=r,this.startByClient=a,this.taskLogger=new Ls(n)}get signal(){return this.abortCtrl.signal}setPriority(e){this.priority=e}start(){return z(this,null,function*(){if(this.started)throw new Error("Task already started");this.started=!0;const e=Date.now(),t=new Me;t.set("taskID",this.id);let r,n=null;try{return r=yield this.startByClient(t,this),r}catch(a){throw n=a,a}finally{const{logOnError:a,logOnTransfered:d}=this.log(t,e);r==null?a(n):r.underlayer.bodyReadResult.then(c=>{c.success?d():a(c.error)})}})}log(e,t){const r=e.get("taskCacheMatchAt"),n=e.get("task1stHttpDoAt"),a=e.get("taskResultStreamAt"),d=Date.now(),c=l=>{var w,o,h,u,f;return this.taskLogger.log(Z({type:(w=e.get("taskType"))!=null?w:1,id:this.id,url:this.url,err_msg:"",err_desc:"",range_st:(h=(o=this.range)==null?void 0:o.start)!=null?h:-1,range_end:(f=(u=this.range)==null?void 0:u.end)!=null?f:-1,ts_st:t,t_cc_match:se(r,t),t_http_do:se(n,r),t_res_stream:se(a,r),t_res:se(d,a),t_trans:-1,t_total:-1},l))};return{logOnError:l=>{const w=Date.now();c(Z({t_total:se(w,t)},Ve(l)))},logOnTransfered:()=>{const l=Date.now();c({t_trans:se(l,d),t_total:se(l,t)})}}}cancel(e){this.abortCtrl.abort(e)}}class Fr{constructor(e,t,r,n,a){this.stream=e,this.size=t,this.fileSize=r,this.contentType=n,this.underlayer=a}blob(){return z(this,null,function*(){const t=this.stream.getReader(),r=[];for(;;){const{done:n,value:a}=yield t.read();if(n)break;const d=a;r.push(d)}return new Blob(r)})}}function St(s,e,t){return s!=null&&t!=null&&t>=s&&(t=null),(e==null||e<0)&&(e=0),[e,t]}function Nr(s,e){var n;const t=((n=e[0])!=null?n:0)===0,r=e[1]==null||s!=null&&e[1]===s;return t&&r}function Is(s,e){var n,a;const t=(n=e[0])!=null?n:0,r=(a=e[1])!=null?a:s;return r==null?null:r-t}function Os(s,e,t){var x,i;if(e===0)return[];const r=(l,w)=>Fs(l,w,e!=null?e:Number.POSITIVE_INFINITY),n=(x=s==null?void 0:s[0])!=null?x:0,a=(i=s==null?void 0:s[1])!=null?i:e,d=[];let c=n;for(const l of t){if(c==null||e!=null&&l[1]!=null&&l[1]>e)break;if(!(l[1]!=null&&c>=l[1])){if(a==null||a>l[0]){l[0]>c&&d.push({cached:!1,range:St(e,c,l[0])});const w=r(l[0],c)?l[0]:c,o=r(l[1],a)?a:l[1];r(o,w)&&(d.push({cached:!0,range:St(e,w,o)}),c=o);continue}break}}return r(a,c)&&d.push({cached:!1,range:St(e,c,a)}),d}function qs(s,e){var n;const t=(n=e[0])!=null?n:0,r=e[1];for(const a of s){if(a[1]!=null&&a[1]<=t)continue;if(a[0]>t)break;const d=t-a[0],c=Ns(r!=null?r:a[1],a[0]);return{piece:a,start:d,end:c}}throw new Error("Piece not found")}function Ws(s,e){return[...s,e].sort((t,r)=>t[0]-r[0])}function Fs(s,e,t){const r=s!=null?s:t,n=e!=null?e:t;return r>n}function Ns(s,e){return s==null||e==null?null:s-e}const Us={threshold:1024*1024*2,contentRangeExposed:!0},oe=ve("ftask");class Ms{constructor(e,t,r,n,a,d){L(this,"id",Xe());L(this,"inited");L(this,"cachePieces",[]);L(this,"meta",null);this.cache=e,this.http=t,this.key=r,this.url=n,this.patterns=a,this.mediaOptimization=d,this.inited=this.resume()}startTask(e,t){return z(this,null,function*(){var c;oe("startTask",t.url);let r;const n=t.range!=null?[t.range.start,t.range.end]:[0,null];if(Ze())r=yield this.readRangeByPieces(e,t,n);else{oe("supportStreamOperation: false",t.url,t.id);const x=[(c=n[0])!=null?c:0,n[1]],i=yield this.cache.getContent(this.key,x);e.set("taskCacheMatchAt",Date.now()),i!=null?(oe("use cache",t.url,t.id),r=i):(oe("doRequestAndSaveCache",t.url,t.id),r=yield this.doRequestAndSaveCache(e,t,n)),e.set("taskResultStreamAt",Date.now())}yield this.inited;const a=this.meta;if(a==null)throw new Error("Missing meta in fileTask");oe("startTask resolved",t.url,t.id);const d=Is(a.fsize,n);return new Fr(r.body,d,a.fsize,a.contentType,r)})}readRangeByPieces(e,t,r){return z(this,null,function*(){var c,x,i,l;yield this.inited;const n=Os(r,(x=(c=this.meta)==null?void 0:c.fsize)!=null?x:null,this.cachePieces);oe("applyRange",r,(l=(i=this.meta)==null?void 0:i.fsize)!=null?l:null,this.cachePieces,n),e.set("taskCacheMatchAt",Date.now());const a=new TransformStream(void 0),d=yield new Promise((w,o)=>z(this,null,function*(){try{for(let h=0;h<n.length;h++){const{cached:u,range:f}=n[h],v=yield u?this.readPieceFromLocal(e,t,f):this.readPieceFromRemote(e,t,f);h===0&&w(v);const g=h===n.length-1;yield v.body.pipeTo(a.writable,{preventClose:!g})}}catch(h){h!=null&&console.warn("readRange stream error for",this.url,h),a.writable.abort(h),o(h)}}));return e.set("taskResultStreamAt",Date.now()),new _e(a.readable,d)})}readPieceFromLocal(e,t,r){return z(this,null,function*(){oe("readPieceFromLocal",t.url,r);const{piece:n,start:a,end:d}=qs(this.cachePieces,r),c=yield this.cache.getContent(this.key,n);return c==null?(console.warn(`Missing cache item: ${this.key} [${n})`),this.readPieceFromRemote(e,t,r)):new _e(l0(c.body,[a,d]),c)})}fileSize(){var e,t;return(t=(e=this.meta)==null?void 0:e.fsize)!=null?t:null}readPieceFromRemote(e,t,r){return z(this,null,function*(){oe("readPieceFromRemote",t.url,r);const n=yield this.doRequestAndSaveCache(e,t,r);return!Nr(this.fileSize(),r)&&n.status===200?(console.warn("Range request not supported for",this.url),new _e(l0(n.body,r),n)):n})}doRequest(e,t,r){return z(this,null,function*(){const n=new Me(e);n.set("downloadFileTaskID",this.id);const a={"Accept-Encoding":"identity;q=1, *;q=0"};r!=null&&(t.range==null&&Nr(this.fileSize(),r)||(a.Range=_0({start:r[0],end:r[1]==null?null:r[1]-1})));const d=new ze(this.url,{method:"GET",headers:a,signal:t.signal});let c;if(!Ze()||this.mediaOptimization.threshold<=0?c=yield this.http.do(n,d):c=yield $s((...x)=>this.http.do(...x),qr,this.mediaOptimization,this.patterns)(n,d),c.body==null)throw new Error("Body expected");if(c.status!==200&&c.status!==206)throw new dt(c);return this.saveMeta(c),c.bodyReadResult.then(x=>{oe(`bodyReadResult for ${this.url}:`,x)}),c})}doRequestAndSaveCache(e,t,r){return z(this,null,function*(){e.get("task1stHttpDoAt")==null&&e.set("task1stHttpDoAt",Date.now());const n=yield this.doRequest(e,t,r);return this.saveCachePiece(t,r,n)})}saveCachePiece(e,t,r){return z(this,null,function*(){var d,c;let n=r,a;if(Ze()){const{main:x,minor:i}=Zn(r.body);n=new _e(x,r),a=new _e(i,r)}else if(!e.range){const x=r.underlayer.clone();a=f0(x)}if(a!=null){const x=[(d=t==null?void 0:t[0])!=null?d:0,(c=t==null?void 0:t[1])!=null?c:null];oe("saveCachePiece",this.url,x),this.cache.setContent(this.key,x,a).then(()=>(this.cachePieces=Ws(this.cachePieces,x),this.save())).then(()=>oe("saveCachePiece finish",this.url,x),i=>oe("saveCachePiece failed",this.url,i))}return n})}saveMeta(e){return z(this,null,function*(){this.meta={contentType:e.headers.get("Content-Type"),fsize:Lt(e)},yield this.save()})}resume(){return z(this,null,function*(){const e=yield this.cache.getItem(this.key);e==null||e.meta==null||(this.meta=e.meta,this.cachePieces=e.pieces)})}save(){return z(this,null,function*(){const e={meta:this.meta,pieces:this.cachePieces};yield this.cache.setItem(this.key,e)})}}function $s(s,e,{threshold:t,contentRangeExposed:r},n){return function(d,c){return z(this,null,function*(){var k,S;const R=c,{url:x}=R,i=n0(R,["url"]),l=i0(x);if(c.method!=="GET"||!n.media.some(m=>m.test(l)))return s(d,c);oe("doWithInitialOptimization",x);const w=new Me(d),o=new ze(x,i),u=yield((m,C)=>z(this,null,function*(){var O;let A=null;const B=a0(C.headers);B!=null&&!Ht(B)&&!r&&(A=Gs(x,i.headers,e));const I=yield e(m,C);if(B!=null&&I.status===206&&!I.headers.get("Content-Range")){const W=Ht(B)?je(I.headers):yield A;if(W!=null){const j=m0({start:B.start,end:(O=B.end)!=null?O:W-1,totalSize:W});I.headers.set("Content-Range",j)}}return I}))(w,o),f=je(u.headers);if(f!=null&&f<=t)return u;const v=new Headers(i.headers),y=(k=a0(v))!=null?k:{start:null,end:null};if(y.start=((S=y.start)!=null?S:0)+t,y.end!=null&&y.end<y.start)return u;oe("doWithInitialOptimization followingRange",y),v.set("Range",_0(y));const g=new ze(x,be(Z({},i),{headers:v})),P=u,{body:p}=P,b=n0(P,["body"]),_=new TransformStream;if(p==null)throw new Error(`Body expected for initial response of ${x}`);return l0(p,[0,t]).pipeTo(_.writable,{preventClose:!0}).then(()=>z(this,null,function*(){oe("doWithInitialOptimization initialBody transfered");const m=yield s(d,g);if(m.body==null)throw new Error(`Body expected for following response of ${x}`);(m.status===206?m.body:l0(m.body,[y.start,y.end==null?null:y.end+1])).pipeTo(_.writable).then(()=>oe("doWithInitialOptimization followingBody transfered"),A=>oe("doWithInitialOptimization followingBody transfer errored",A))}),m=>z(this,null,function*(){oe("doWithInitialOptimization initialBody transfer errored",m)})),new _e(_.readable,b)})}}function Gs(s,e,t){return z(this,null,function*(){const r=new Headers(e);r.delete("Range");const n=yield t(new Me,new ze(s,{method:"HEAD",headers:r}));return je(n.headers)})}const Ur=ve("utils/taskq");class js{constructor(e){L(this,"tasks",[]);L(this,"emitter",new lt);L(this,"running",!0);for(let t=0;t<e;t++)this.comsumeLoop()}add(e){let t=0;for(;t<this.tasks.length&&!(this.tasks[t].priority>=e.priority);t++);this.tasks.splice(t,0,e),this.emitter.emit("task")}pop(){return z(this,null,function*(){const e=this.tasks.pop();return e!=null?e:new Promise(t=>{const r=this.emitter.on("task",()=>{const n=this.tasks.pop();n!=null&&(t(n),r())})})})}consumeTask(){return z(this,null,function*(){if(!this.running)return;const e=yield this.pop();Ur("run task",e.name,", with priority:",e.priority);try{yield e==null?void 0:e.run()}catch(t){console.warn("Task run failed:",t)}finally{Ur("end task",e.name)}})}comsumeLoop(){return z(this,null,function*(){for(;this.running;)yield this.consumeTask()})}dispose(){this.emitter.dispose(),this.running=!1}}const Mr=10;class Xs{constructor(e,t){L(this,"taskq");this.resolver=e,this.taskq=new js(t!=null?t:Mr)}getFingerprint(e){return this.resolver.getFingerprint(e)}resolve(e,t,r,n){return this.resolver.do(e,t.url,r,!1,n)}fetch(e,t,r){return z(this,null,function*(){return new Promise(n=>this.taskq.add({name:t.url,priority:0,run:()=>z(this,null,function*(){const a=Ks(t,r),d=this._fetch(e,a);n(d),yield(yield d).bodyReadResult})}))})}}function Ks(s,e){const{url:t,method:r,headers:n,signal:a,body:d}=s,c=new URL(t),x=c.host;c.host=e;const i=new Headers(n);return i.set("Host",x),new ze(c.toString(),{method:r,headers:i,signal:a,body:d})}class Vs extends Xs{constructor(t,r,n,a=Mr){super(t,a);L(this,"hoW");if(Ys())throw new Error("HoWHttpClientForWindow should not be used in Service Worker");this.hoW=new ns(r,n)}_fetch(t,r){return z(this,null,function*(){var c,x;const n=Xe(),a=this.getFingerprint(new URL(r.url).host),d=yield this.hoW.fetch(t,n,r,a);return t.set("downloadConnectionAt",(c=t.get("hoWDataChannelOpenAt"))!=null?c:-1),t.set("downloadStartTransferAt",(x=t.get("hoWStartTransferAt"))!=null?x:-1),d})}dispose(){this.hoW.dispose()}}function Ys(){const s=self;return!!(s.clients&&s.registration)}class Bt{constructor(e,t=!0,r=self.fetch){this.resolver=e,this.https=t,this.nativeFetch=r}resolve(e,t,r,n){return z(this,null,function*(){return this.resolver.do(e,t.url,r,!0,n)})}fetch(e,t,r){return z(this,null,function*(){const n=this.nativeFetch,a=Qs(t,r,this.https),d=yield n(a),c=Date.now();return e.set("downloadConnectionAt",c),e.set("downloadStartTransferAt",c),f0(d)})}dispose(){}}function Zs(s,e){return new Request(s,Z({mode:"cors",credentials:"omit"},e))}function Qs(s,e,t=!0){const{url:r,headers:n,method:a,signal:d}=s,c=new URL(r),x=c.host,i=new Headers(n),[l,w]=ct(e),o=w+(t?443:80);c.protocol=t?"https:":"http:",c.host=`${l}:${o}`,c.pathname=`/${x}${c.pathname}`;let h=c.toString();if(i.has("X-Miku-Agent")){const u=i.get("X-Miku-Agent");i.delete("X-Miku-Agent");const f=h.includes("?")?"&":"?",v=["X-Miku-Agent",u].map(encodeURIComponent).join("=");h=h+f+v}return Zs(h,{headers:i,method:a,signal:d,keepalive:!0})}function Js(s){const e=[],t=s.split(`
`).map(n=>n.trim()).filter(n=>n.length>0);if(t[0]!=="#EXTM3U")throw new Error("Invalid Extended M3U Playlist");let r=null;for(const n of t){if(n.startsWith("#")){n.startsWith("#EXTINF:")&&(r=n);continue}r!=null&&(e.push({uri:n}),r=null)}return e}const $r=ve("client");class ea{constructor(e,t){L(this,"fileTasks",new Map);L(this,"cache");L(this,"cacheUrlFn");L(this,"cdnResolver");L(this,"liveResolver");L(this,"http");L(this,"liveHttp");L(this,"liveOptimization");L(this,"patterns");L(this,"mediaOptimization");L(this,"logger");var d,c,x,i,l,w;t!=null&&t.debug&&ln(),this.cache=new As(t==null?void 0:t.cache),this.cacheUrlFn=(d=t==null?void 0:t.cacheUrl)!=null?d:ta,this.logger=(c=t==null?void 0:t.logger)!=null?c:new _t(e),this.cdnResolver=new Dr(this.logger,e,t==null?void 0:t.dnsResolver),this.liveResolver=(x=t==null?void 0:t.liveResolver)!=null?x:new Hr(this.logger,e,t==null?void 0:t.scheduler);const r=(i=t==null?void 0:t.httpClient)!=null?i:new Vs(this.cdnResolver),n=(l=t==null?void 0:t.liveHttpClient)!=null?l:new Bt(this.liveResolver);this.patterns=Z(Z({},Cr),t==null?void 0:t.patterns),this.mediaOptimization=Z(Z({},Us),t==null?void 0:t.mediaOptimization),this.http=new Ir(this.logger,r);const a=2e3;this.liveHttp=new Ir(this.logger,n,a),this.liveOptimization=(w=t==null?void 0:t.liveOptimization)!=null?w:!0}createTask(e,t){const r=e.indexOf("#");return r>=0&&(e=e.slice(0,r)),new Wr(e,t!=null?t:null,Number.POSITIVE_INFINITY,this.logger,(n,a)=>(n.set("taskType",1),this.startTask(n,a)))}createLiveTask(e,t){const r=e.indexOf("#");return r>=0&&(e=e.slice(0,r)),new Wr(e,t!=null?t:null,0,this.logger,(n,a)=>(n.set("taskType",2),this.startLiveTask(n,a)))}startTask(e,t){const r=this.cacheUrlFn(t.url);let n=this.fileTasks.get(r);return n==null&&(n=new Ms(this.cache,this.http,r,t.url,this.patterns,this.mediaOptimization),this.fileTasks.set(r,n)),n.startTask(e,t)}saveM3u8SegmentResult(e,t){return z(this,null,function*(){const r=yield Vn(t),a=Js(r).map(d=>jn(d.uri,e));$r("saveM3u8SegmentResult",i0(e),a.map(i0)),yield this.liveResolver.saveM3u8SegmentResult(e,a)})}startLiveTask(e,t){return z(this,null,function*(){const r={};t.range!=null&&(r.Range=_0({start:t.range.start,end:t.range.end==null?null:t.range.end-1}));const n=new ze(t.url,{method:"GET",headers:r,signal:t.signal});let a,d=this.liveOptimization&&c0(t.url)&&!this.liveResolver.hasResult(t.url);if(d){$r("use nativeDo for",t.url);const x=qr(e,n);this.liveHttp.do(e,n).catch(i=>{console.warn("do failed when prefetch for liveOptimization:",i)}),a=yield x}else a=yield this.liveHttp.do(e,n);if(a.body==null)throw new Error("Body expected");if(a.status!==200&&a.status!==206)throw new Error(`Invalid response, status: ${a.status}`);let c=a.body;if(!d&&u0()&&c0(t.url)){const[x,i]=a.body.tee();this.saveM3u8SegmentResult(t.url,i).catch(l=>{console.warn("Save M3u8 segment cache failed:",t.url,l)}),c=x}return new Fr(c,je(a.headers),Lt(a),a.headers.get("Content-Type"),a)})}dispose(){this.cache.dispose()}}function ta(s){return s}function ra(s){return s&&s.mikuProxy===!0}const na=ve("proxy/common");function sa(s,e){return z(this,null,function*(){var u;const{browser:t}=ht(navigator.userAgent);if(t.name==="Firefox"&&e.headers.get("Range")){na("Short circuit for Firefox:",e.url);const f=yield s.cdnResolver.resolve(new Me,e.url,!0),v=zs(e,f);return Response.redirect(v.url)}const r=a0(e.headers),n=r==null?void 0:{start:r.start,end:r.end==null?null:r.end+1},a=s.createTask(e.url,n!=null?n:void 0);e.signal!=null&&Ke(e.signal).catch(f=>{a.cancel(f)});let d;try{d=yield a.start()}catch(f){if(f instanceof dt){const{status:v,statusText:y,headers:g,body:p,underlayer:b}=f.response;return b!=null?b:new Response(p,{status:v,statusText:y,headers:g})}throw f}let{stream:c,contentType:x,size:i,fileSize:l,underlayer:w}=d;if(!Ze())return w.underlayer;let o=C0(w==null?void 0:w.headers);return o.set("Accept-Ranges","bytes"),o.set("Access-Control-Allow-Origin","*"),o.set("Content-Type",x!=null?x:""),o.set("Content-Length",(i!=null?i:"")+""),o.set("Content-Transfer-Encoding","binary"),n!=null&&o.set("Content-Range",m0({start:(u=n.start)!=null?u:0,end:n.end!=null?n.end-1:l!=null?l-1:null,totalSize:l})),new Response(c,{status:n==null?200:206,statusText:n==null?"OK":"Partial Content",headers:o})})}function aa(s,e){return z(this,null,function*(){var o;const t=a0(e.headers),r=t==null?void 0:{start:t.start,end:t.end==null?null:t.end+1},n=s.createLiveTask(e.url,r!=null?r:void 0);Ke(e.signal).catch(h=>{n.cancel(h)});let{stream:a,contentType:d,size:c,fileSize:x,underlayer:i}=yield n.start();if(!u0())return i.underlayer;let l=new Headers(i==null?void 0:i.headers);return l.set("Accept-Ranges","bytes"),l.set("Access-Control-Allow-Origin","*"),l.set("Content-Type",d!=null?d:""),l.set("Content-Length",(c!=null?c:"")+""),r!=null&&l.set("Content-Range",m0({start:(o=r.start)!=null?o:0,end:r.end!=null?r.end-1:x!=null?x-1:null,totalSize:x})),new Response(a,{status:r==null?200:206,statusText:r==null?"OK":"Partial Content",headers:l})})}const oa="MIKU_PROXY_CONFIG";function ia(s){const e=s.split("?")[1];if(!e)throw new Error("Invalid script url");const r=new URLSearchParams(e).get(oa);if(r==null)throw new Error("Invalid script url: no config info");const n=JSON.parse(r),a=d=>d==null?void 0:d.map(({source:c,flags:x})=>new RegExp(c,x));return be(Z({},n),{patterns:n.patterns==null?void 0:mr(n.patterns,d=>a(d))})}function ca(s){return Array.isArray(s)?{cdn:s,live:[]}:Z({cdn:[],live:[]},s)}function Gr(s,e){const t=s.hostname;return e.includes("*")||e.includes(t)}class la{constructor(){L(this,"windowFetchItemsMap",new Map)}onFetchItem(e,t,r,n,a){const d={url:t,ecdn:n,fallback:a!=null?a:!1,size:je(r.headers)};let c=this.windowFetchItemsMap.get(e);c==null&&(c=[],this.windowFetchItemsMap.set(e,c)),c.push(d)}onWindowClose(e){this.windowFetchItemsMap.delete(e)}getFetchItems(e){return this.windowFetchItemsMap.get(e)||[]}}function jr(t){return z(this,arguments,function*(s,e={}){const{url:r,headers:n,method:a,redirect:d,signal:c}=s,x=self.location.host,i=new URL(r).host;if(x===i)return fetch(s,e);const l=new Request(r,Z({mode:"cors",credentials:"omit",headers:n,method:a,redirect:d,signal:c},e));try{return yield fetch(l)}catch(w){return console.warn("Request with CORS failed:",r,w),fetch(s)}})}class ua{constructor(e){this.logger=e}log(e){return this.logger.log("PageStatusLog",e)}}const x0=ve("proxy/service-worker"),Se=new Map,t0=self,Be=ia(t0.location.href),Xr=ha(Be),r0=new la,fa=new _t(Be.app,void 0,void 0,3),$e=new ua(fa);t0.addEventListener("activate",s=>{s.waitUntil(t0.clients.claim()),Ne.onRemove(e=>{r0.onWindowClose(e)})}),t0.addEventListener("fetch",s=>z(this,null,function*(){s.clientId!==""&&Ne.add(s.clientId);const e=s.request;if(e.method==="GET"){const t=new URL(e.url),r=ca(Be.domains),n=Z(Z({},Cr),Be.patterns),a=new AbortController;if(_r(a,s.request.signal),Object.defineProperty(e,"signal",{value:a.signal}),Ne.whenRemoved(s.clientId,()=>a.abort(new Gn(`Source client ${s.clientId} closed`))),Gr(t,r.cdn)&&Rr(t,n))return da(s,e);if(Gr(t,r.live)&&Rr(t,n,["live"]))return xa(s,e)}e.method==="GET"&&Be.statistics&&s.respondWith(jr(e).then(t=>{var r;return r0.onFetchItem(s.clientId,e.url,t,!1),$e.log({r_id:(r=Se.get(s.clientId))!=null?r:"",text:t.statusText,code:t.status,url:e.url}),t}).catch(t=>{var r;return $e.log({r_id:(r=Se.get(s.clientId))!=null?r:"",text:t instanceof Error?t.message:"",code:-1,url:e.url}),t}))})),t0.addEventListener("message",s=>z(this,null,function*(){if(s.source instanceof WindowClient&&!!ra(s.data))switch(x0("got proxy message",s.data,"from",s.source.id),s.data.type){case"window-available":Ne.add(s.source.id);break;case"window-unavailable":Ne.remove(s.source.id),Se.delete(s.source.id);break;case"get-window-fetch-items":const e=s.source.id,t=r0.getFetchItems(e),r=yield Ne.get(e);if(r==null)throw new Error(`Invalid window client ID: ${e}`);const n={mikuProxy:!0,type:"window-fetch-items",items:t};r.postMessage(n);break;case"get-perf-rid":Se.set(s.source.id,s.data.rid)}}));function ha(s){const e=Z({debug:s.debug,patterns:s.patterns},s.client),t=new _t(s.app,void 0,void 0,3),r=new Dr(t,s.app),n=new Bt(r),a=new Hr(t,s.app,void 0,e.cacheUrl),d=new Bt(a);return new ea(s.app,be(Z({},e),{logger:t,httpClient:n,liveResolver:a,liveHttpClient:d}))}function Kr(s){return[vt,Ue,pt,wt].some(e=>s instanceof e)}function da(s,e){x0("use cdn",e.url),s.respondWith(sa(Xr,e).then(t=>{var r;return Be.statistics&&(r0.onFetchItem(s.clientId,e.url,t,!0,!1),$e.log({r_id:(r=Se.get(s.clientId))!=null?r:"",text:t.statusText,code:t.status,url:e.url})),t},t=>z(this,null,function*(){var r,n,a;if(Kr(t))if(x0("Use fallback fetch for request",e.url,", error:",t),Be.statistics)try{const d=yield jr(e);return r0.onFetchItem(s.clientId,e.url,d,!0,!0),$e.log({r_id:(r=Se.get(s.clientId))!=null?r:"",text:d.statusText,code:d.status,url:e.url}),d}catch(d){throw $e.log({r_id:(n=Se.get(s.clientId))!=null?n:"",text:d instanceof Error?d.message:"",code:-1,url:e.url}),d}else return fetch(e);throw Be.statistics&&$e.log({r_id:(a=Se.get(s.clientId))!=null?a:"",text:t instanceof Error?t.message:"",code:-1,url:e.url}),t})))}function xa(s,e){s.respondWith(aa(Xr,e).then(void 0,t=>z(this,null,function*(){if(Kr(t))return x0("Use fallback fetch for request",e.url,", error:",t),fetch(e);throw t})))}})();
